/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("datatype-xml-parse",function(e,t){e.mix(e.namespace("XML"),{parse:function(t){var n=null,r;return typeof t=="string"&&(r=e.config.win,r.ActiveXObject!==undefined?(n=new ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(t)):r.DOMParser!==undefined?n=(new DOMParser).parseFromString(t,"text/xml"):r.Windows!==undefined&&(n=new Windows.Data.Xml.Dom.XmlDocument,n.loadXml(t))),n===null||n.documentElement===null||n.documentElement.nodeName==="parsererror",n}}),e.namespace("Parsers").xml=e.XML.parse,e.namespace("DataType"),e.DataType.XML=e.XML},"3.17.2");
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("io-xdr",function(e,t){function a(e,t,n){var r='<object id="io_swf" type="application/x-shockwave-flash" data="'+e+'" width="0" height="0">'+'<param name="movie" value="'+e+'">'+'<param name="FlashVars" value="yid='+t+"&uid="+n+'">'+'<param name="allowScriptAccess" value="always">'+"</object>",i=s.createElement("div");s.body.appendChild(i),i.innerHTML=r}function f(t,n,r){return n==="flash"&&(t.c.responseText=decodeURI(t.c.responseText)),r==="xml"&&(t.c.responseXML=e.DataType.XML.parse(t.c.responseText)),t}function l(e,t){return e.c.abort(e.id,t)}function c(e){return u?i[e.id]!==4:e.c.isInProgress(e.id)}var n=e.publish("io:xdrReady",{fireOnce:!0}),r={},i={},s=e.config.doc,o=e.config.win,u=o&&o.XDomainRequest;e.mix(e.IO.prototype,{_transport:{},_ieEvt:function(e,t){var n=this,r=e.id,s="timeout";e.c.onprogress=function(){i[r]=3},e.c.onload=function(){i[r]=4,n.xdrResponse("success",e,t)},e.c.onerror=function(){i[r]=4,n.xdrResponse("failure",e,t)},e.c.ontimeout=function(){i[r]=4,n.xdrResponse(s,e,t)},e.c[s]=t[s]||0},xdr:function(t,n,i){var s=this;return i.xdr.use==="flash"?(r[n.id]=i,o.setTimeout(function(){try{n.c.send(t,{id:n.id,uid:n.uid,method:i.method,data:i.data,headers:i.headers})}catch(e){s.xdrResponse("transport error",n,i),delete r[n.id]}},e.io.xdr.delay)):u?(s._ieEvt(n,i),n.c.open(i.method||"GET",t),setTimeout(function(){n.c.send(i.data)},0)):n.c.send(t,n,i),{id:n.id,abort:function(){return n.c?l(n,i):!1},isInProgress:function(){return n.c?c(n.id):!1},io:s}},xdrResponse:function(e,t,n){n=r[t.id]?r[t.id]:n;var s=this,o=u?i:r,a=n.xdr.use,l=n.xdr.dataType;switch(e){case"start":s.start(t,n);break;case"success":s.success(f(t,a,l),n),delete o[t.id];break;case"timeout":case"abort":case"transport error":t.c={status:0,statusText:e};case"failure":s.failure(f(t,a,l),n),delete o[t.id]}},_xdrReady:function(t,r){e.fire(n,t,r)},transport:function(t){t.id==="flash"&&(a(e.UA.ie?t.src+"?d="+(new Date).valueOf().toString():t.src,e.id,t.uid),e.IO.transports.flash=function(){return s.getElementById("io_swf")})}}),e.io.xdrReady=function(t,n){var r=e.io._map[n];e.io.xdr.delay=0,r._xdrReady.apply(r,[t,n])},e.io.xdrResponse=function(t,n,r){var i=e.io._map[n.uid];i.xdrResponse.apply(i,[t,n,r])},e.io.transport=function(t){var n=e.io._map["io:0"]||new e.IO;t.uid=n._uid,n.transport.apply(n,[t])},e.io.xdr={delay:100}},"3.17.2",{requires:["io-base","datatype-xml-parse"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("io-upload-iframe",function(e,t){function u(t,n,r){var i=e.Node.create('<iframe id="io_iframe'+t.id+'" name="io_iframe'+t.id+'" />');i._node.style.position="absolute",i._node.style.top="-1000px",i._node.style.left="-1000px",e.one("body").appendChild(i),e.on("load",function(){r._uploadComplete(t,n)},"#io_iframe"+t.id)}function a(t){e.Event.purgeElement("#io_iframe"+t,!1),e.one("body").removeChild(e.one("#io_iframe"+t))}var n=e.config.win,r=e.config.doc,i=r.documentMode&&r.documentMode>=8,s=decodeURIComponent,o=e.IO.prototype.end;e.mix(e.IO.prototype,{_addData:function(t,n){e.Lang.isObject(n)&&(n=e.QueryString.stringify(n));var i=[],o=n.split("="),u,a;for(u=0,a=o.length-1;u<a;u++)i[u]=r.createElement("input"),i[u].type="hidden",i[u].name=s(o[u].substring(o[u].lastIndexOf("&")+1)),i[u].value=u+1===a?s(o[u+1]):s(o[u+1].substring(0,o[u+1].lastIndexOf("&"))),t.appendChild(i[u]);return i},_removeData:function(e,t){var n,r;for(n=0,r=t.length;n<r;n++)e.removeChild(t[n])},_setAttrs:function(t,n,r){this._originalFormAttrs={action:t.getAttribute("action"),target:t.getAttribute("target")},t.setAttribute("action",r),t.setAttribute("method","POST"),t.setAttribute("target","io_iframe"+n),t.setAttribute(e.UA.ie&&!i?"encoding":"enctype","multipart/form-data")},_resetAttrs:function(t,n){e.Object.each(n,function(e,n){e?t.setAttribute(n,e):t.removeAttribute(n)})},_startUploadTimeout:function(e,t){var r=this;r._timeout[e.id]=n.setTimeout(function(){e.status=0,e.statusText="timeout",r.complete(e,t),r.end(e,t)},t.timeout)},_clearUploadTimeout:function(e){var t=this;n.clearTimeout(t._timeout[e]),delete t._timeout[e]},_uploadComplete:function(t,r){var i=this,s=e.one("#io_iframe"+t.id).get("contentWindow.document"),o=s.one("body"),u;r.timeout&&i._clearUploadTimeout(t.id);try{o?(u=o.one("pre:first-child"),t.c.responseText=u?u.get("text"):o.get("text")):t.c.responseXML=s._node}catch(f){t.e="upload failure"}i.complete(t,r),i.end(t,r),n.setTimeout(function(){a(t.id)},0)},_upload:function(t,n,i){var s=this,o=typeof i.form.id=="string"?r.getElementById(i.form.id):i.form.id,u;return s._setAttrs(o,t.id,n),i.data&&(u=s._addData(o,i.data)),i.timeout&&s._startUploadTimeout(t,i),o.submit(),s.start(t,i),i.data&&s._removeData(o,u),{id:t.id,abort:function(){t.status=0,t.statusText="abort";if(!e.one("#io_iframe"+t.id))return!1;a(t.id),s.complete(t,i),s.end(t,i)},isInProgress:function(){return e.one("#io_iframe"+t.id)?!0:!1},io:s}},upload:function(e,t,n){return u(e,n,this),this._upload(e,t,n)},end:function(e,t){var n,i;return t&&(n=t.form,n&&n.upload&&(i=this,n=typeof n.id=="string"?r.getElementById(n.id):n.id,n&&i._resetAttrs(n,this._originalFormAttrs))),o.call(this,e,t)}},!0)},"3.17.2",{requires:["io-base","node-base"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("queue-promote",function(e,t){e.mix(e.Queue.prototype,{indexOf:function(t){return e.Array.indexOf(this._q,t)},promote:function(e){var t=this.indexOf(e);t>-1&&this._q.unshift(this._q.splice(t,1)[0])},remove:function(e){var t=this.indexOf(e);t>-1&&this._q.splice(t,1)}})},"3.17.2",{requires:["yui-base"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("io-queue",function(e,t){function r(e,t){return n.queue.apply(n,[e,t])}var n=e.io._map["io:0"]||new e.IO;e.mix(e.IO.prototype,{_q:new e.Queue,_qActiveId:null,_qInit:!1,_qState:1,_qShift:function(){var e=this,t=e._q.next();e._qActiveId=t.id,e._qState=0,e.send(t.uri,t.cfg,t.id)},queue:function(t,n){var r=this,i={uri:t,cfg:n,id:this._id++};return r._qInit||(e.on("io:complete",function(e,t){r._qNext(e)},r),r._qInit=!0),r._q.add(i),r._qState===1&&r._qShift(),i},_qNext:function(e){var t=this;t._qState=1,t._qActiveId===e&&t._q.size()>0&&t._qShift()},qPromote:function(e){this._q.promote(e)},qRemove:function(e){this._q.remove(e)},qEmpty:function(){this._q=new e.Queue},qStart:function(){var e=this;e._qState=1,e._q.size()>0&&e._qShift()},qStop:function(){this._qState=0},qSize:function(){return this._q.size()}},!0),r.start=function(){n.qStart()},r.stop=function(){n.qStop()},r.promote=function(e){n.qPromote(e)},r.remove=function(e){n.qRemove(e)},r.size=function(){n.qSize()},r.empty=function(){n.qEmpty()},e.io.queue=r},"3.17.2",{requires:["io-base","queue-promote"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("event-simulate",function(e,t){(function(){function v(t,n,a,f,l,c,h,p,d,v,m){t||e.error("simulateKeyEvent(): Invalid target.");if(i(n)){n=n.toLowerCase();switch(n){case"textevent":n="keypress";break;case"keyup":case"keydown":case"keypress":break;default:e.error("simulateKeyEvent(): Event type '"+n+"' not supported.")}}else e.error("simulateKeyEvent(): Event type must be a string.");s(a)||(a=!0),s(f)||(f=!0),o(l)||(l=e.config.win),s(c)||(c=!1),s(h)||(h=!1),s(p)||(p=!1),s(d)||(d=!1),u(v)||(v=0),u(m)||(m=0);var g=null;if(r(e.config.doc.createEvent)){try{g=e.config.doc.createEvent("KeyEvents"),g.initKeyEvent(n,a,f,l,c,h,p,d,v,m)}catch(y){try{g=e.config.doc.createEvent("Events")}catch(b){g=e.config.doc.createEvent("UIEvents")}finally{g.initEvent(n,a,f),g.view=l,g.altKey=h,g.ctrlKey=c,g.shiftKey=p,g.metaKey=d,g.keyCode=v,g.charCode=m}}t.dispatchEvent(g)}else o(e.config.doc.createEventObject)?(g=e.config.doc.createEventObject(),g.bubbles=a,g.cancelable=f,g.view=l,g.ctrlKey=c,g.altKey=h,g.shiftKey=p,g.metaKey=d,g.keyCode=m>0?m:v,t.fireEvent("on"+n,g)):e.error("simulateKeyEvent(): No event simulation framework present.")}function m(t,n,l,c,h,p,d,v,m,g,y,b,w,E,S,x){t||e.error("simulateMouseEvent(): Invalid target."),i(n)?!a[n.toLowerCase()]&&!f[n]&&e.error("simulateMouseEvent(): Event type '"+n+"' not supported."):e.error("simulateMouseEvent(): Event type must be a string."),s(l)||(l=!0),s(c)||(c=n!=="mousemove"),o(h)||(h=e.config.win),u(p)||(p=1),u(d)||(d=0),u(v)||(v=0),u(m)||(m=0),u(g)||(g=0),s(y)||(y=!1),s(b)||(b=!1),s(w)||(w=!1),s(E)||(E=!1),u(S)||(S=0),x=x||null;var T=null;if(r(e.config.doc.createEvent))T=e.config.doc.createEvent("MouseEvents"),T.initMouseEvent?T.initMouseEvent(n,l,c,h,p,d,v,m,g,y,b,w,E,S,x):(T=e.config.doc.createEvent("UIEvents"),T.initEvent(n,l,c),T.view=h,T.detail=p,T.screenX=d,T.screenY=v,T.clientX=m,T.clientY=g,T.ctrlKey=y,T.altKey=b,T.metaKey=E,T.shiftKey=w,T.button=S,T.relatedTarget=x),x&&!T.relatedTarget&&(n==="mouseout"?T.toElement=x:n==="mouseover"&&(T.fromElement=x)),t.dispatchEvent(T);else if(o(e.config.doc.createEventObject)){T=e.config.doc.createEventObject(),T.bubbles=l,T.cancelable=c,T.view=h,T.detail=p,T.screenX=d,T.screenY=v,T.clientX=m,T.clientY=g,T.ctrlKey=y,T.altKey=b,T.metaKey=E,T.shiftKey=w;switch(S){case 0:T.button=1;break;case 1:T.button=4;break;case 2:break;default:T.button=0}T.relatedTarget=x,t.fireEvent("on"+n,T)}else e.error("simulateMouseEvent(): No event simulation framework present.")}function g(t,n,a,f,l,p){t||e.error("simulateUIEvent(): Invalid target."),i(n)?(n=n.toLowerCase(),c[n]||e.error("simulateUIEvent(): Event type '"+n+"' not supported.")):e.error("simulateUIEvent(): Event type must be a string.");var d=null;s(a)||(a=n in h),s(f)||(f=n==="submit"),o(l)||(l=e.config.win),u(p)||(p=1),r(e.config.doc.createEvent)?(d=e.config.doc.createEvent("UIEvents"),d.initUIEvent(n,a,f,l,p),t.dispatchEvent(d)):o(e.config.doc.createEventObject)?(d=e.config.doc.createEventObject(),d.bubbles=a,d.cancelable=f,d.view=l,d.detail=p,t.fireEvent("on"+n,d)):e.error("simulateUIEvent(): No event simulation framework present.")}function y(t,n,r,i,s,o,u,a,f,l,c,h,p,v,m,g){var y;(!e.UA.ios||e.UA.ios<2)&&e.error("simulateGestureEvent(): Native gesture DOM eventframe is not available in this platform."),t||e.error("simulateGestureEvent(): Invalid target."),e.Lang.isString(n)?(n=n.toLowerCase(),d[n]||e.error("simulateTouchEvent(): Event type '"+n+"' not supported.")):e.error("simulateGestureEvent(): Event type must be a string."),e.Lang.isBoolean(r)||(r=!0),e.Lang.isBoolean(i)||(i=!0),e.Lang.isObject(s)||(s=e.config.win),e.Lang.isNumber(o)||(o=2),e.Lang.isNumber(u)||(u=0),e.Lang.isNumber(a)||(a=0),e.Lang.isNumber(f)||(f=0),e.Lang.isNumber(l)||(l=0),e.Lang.isBoolean(c)||(c=!1),e.Lang.isBoolean(h)||(h=!1),e.Lang.isBoolean(p)||(p=!1),e.Lang.isBoolean(v)||(v=!1),e.Lang.isNumber(m)||(m=1),e.Lang.isNumber(g)||(g=0),y=e.config.doc.createEvent("GestureEvent"),y.initGestureEvent(n,r,i,s,o,u,a,f,l,c,h,p,v,t,m,g),t.dispatchEvent(y)}function b(t,n,r,i,s,o,u,a,f,l,c,h,d,v,m,g,y,b,w){var E;t||e.error("simulateTouchEvent(): Invalid target."),e.Lang.isString(n)?(n=n.toLowerCase(),p[n]||e.error("simulateTouchEvent(): Event type '"+n+"' not supported.")):e.error("simulateTouchEvent(): Event type must be a string."),n==="touchstart"||n==="touchmove"?m.length===0&&e.error("simulateTouchEvent(): No touch object in touches"):n==="touchend"&&y.length===0&&e.error("simulateTouchEvent(): No touch object in changedTouches"),e.Lang.isBoolean(r)||(r=!0),e.Lang.isBoolean(i)||(i=n!=="touchcancel"),e.Lang.isObject(s)||(s=e.config.win),e.Lang.isNumber(o)||(o=1),e.Lang.isNumber(u)||(u=0),e.Lang.isNumber(a)||(a=0),e.Lang.isNumber(f)||(f=0),e.Lang.isNumber(l)||(l=0),e.Lang.isBoolean(c)||(c=!1),e.Lang.isBoolean(h)||(h=!1),e.Lang.isBoolean(d)||(d=!1),e.Lang.isBoolean(v)||(v=!1),e.Lang.isNumber(b)||(b=1),e.Lang.isNumber(w)||(w=0),e.Lang.isFunction(e.config.doc.createEvent)?(e.UA.android?e.UA.android<4?(E=e.config.doc.createEvent("MouseEvents"),E.initMouseEvent(n,r,i,s,o,u,a,f,l,c,h,d,v,0,t),E.touches=m,E.targetTouches=g,E.changedTouches=y):(E=e.config.doc.createEvent("TouchEvent"),E.initTouchEvent(m,g,y,n,s,u,a,f,l,c,h,d,v)):e.UA.ios?e.UA.ios>=2?(E=e.config.doc.createEvent("TouchEvent"),E.initTouchEvent(n,r,i,s,o,u,a,f,l,c,h,d,v,m,g,y,b,w)):e.error("simulateTouchEvent(): No touch event simulation framework present for iOS, "+e.UA.ios+"."):e.error("simulateTouchEvent(): Not supported agent yet, "+e.UA.userAgent),t.dispatchEvent(E)):e.error("simulateTouchEvent(): No event simulation framework present.")}var t=e.Lang,n=e.config.win,r=t.isFunction,i=t.isString,s=t.isBoolean,o=t.isObject,u=t.isNumber,a={click:1,dblclick:1,mouseover:1,mouseout:1,mousedown:1,mouseup:1,mousemove:1,contextmenu:1},f=n&&n.PointerEvent?{pointerover:1,pointerout:1,pointerdown:1,pointerup:1,pointermove:1}:{MSPointerOver:1,MSPointerOut:1,MSPointerDown:1,MSPointerUp:1,MSPointerMove:1},l={keydown:1,keyup:1,keypress:1},c={submit:1,blur
:1,change:1,focus:1,resize:1,scroll:1,select:1},h={scroll:1,resize:1,reset:1,submit:1,change:1,select:1,error:1,abort:1},p={touchstart:1,touchmove:1,touchend:1,touchcancel:1},d={gesturestart:1,gesturechange:1,gestureend:1};e.mix(h,a),e.mix(h,l),e.mix(h,p),e.Event.simulate=function(t,n,r){r=r||{},a[n]||f[n]?m(t,n,r.bubbles,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget):l[n]?v(t,n,r.bubbles,r.cancelable,r.view,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode):c[n]?g(t,n,r.bubbles,r.cancelable,r.view,r.detail):p[n]?e.config.win&&"ontouchstart"in e.config.win&&!e.UA.phantomjs&&!(e.UA.chrome&&e.UA.chrome<6)?b(t,n,r.bubbles,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.touches,r.targetTouches,r.changedTouches,r.scale,r.rotation):e.error("simulate(): Event '"+n+"' can't be simulated. Use gesture-simulate module instead."):e.UA.ios&&e.UA.ios>=2&&d[n]?y(t,n,r.bubbles,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.scale,r.rotation):e.error("simulate(): Event '"+n+"' can't be simulated.")}})()},"3.17.2",{requires:["event-base"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("node-event-html5",function(e,t){e.mix(e.Node.DOM_EVENTS,{DOMActivate:1,DOMContentLoaded:1,afterprint:1,beforeprint:1,canplay:1,canplaythrough:1,durationchange:1,emptied:1,ended:1,formchange:1,forminput:1,hashchange:1,input:1,invalid:1,loadedmetadata:1,loadeddata:1,loadstart:1,offline:1,online:1,pagehide:1,pageshow:1,pause:1,play:1,playing:1,popstate:1,progress:1,ratechange:1,readystatechange:1,redo:1,seeking:1,seeked:1,show:1,stalled:1,suspend:1,timeupdate:1,undo:1,volumechange:1,waiting:1})},"3.17.2",{requires:["node-base"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("async-queue",function(e,t){e.AsyncQueue=function(){this._init(),this.add.apply(this,arguments)};var n=e.AsyncQueue,r="execute",i="shift",s="promote",o="remove",u=e.Lang.isObject,a=e.Lang.isFunction;n.defaults=e.mix({autoContinue:!0,iterations:1,timeout:10,until:function(){return this.iterations|=0,this.iterations<=0}},e.config.queueDefaults||{}),e.extend(n,e.EventTarget,{_running:!1,_init:function(){e.EventTarget.call(this,{prefix:"queue",emitFacade:!0}),this._q=[],this.defaults={},this._initEvents()},_initEvents:function(){this.publish({execute:{defaultFn:this._defExecFn,emitFacade:!0},shift:{defaultFn:this._defShiftFn,emitFacade:!0},add:{defaultFn:this._defAddFn,emitFacade:!0},promote:{defaultFn:this._defPromoteFn,emitFacade:!0},remove:{defaultFn:this._defRemoveFn,emitFacade:!0}})},next:function(){var e;while(this._q.length){e=this._q[0]=this._prepare(this._q[0]);if(!e||!e.until())break;this.fire(i,{callback:e}),e=null}return e||null},_defShiftFn:function(e){this.indexOf(e.callback)===0&&this._q.shift()},_prepare:function(t){if(a(t)&&t._prepared)return t;var r=e.merge(n.defaults,{context:this,args:[],_prepared:!0},this.defaults,a(t)?{fn:t}:t),i=e.bind(function(){i._running||i.iterations--,a(i.fn)&&i.fn.apply(i.context||e,e.Array(i.args))},this);return e.mix(i,r)},run:function(){var e,t=!0;if(this._executing)return this._running=!0,this;for(e=this.next();e&&!this.isRunning();e=this.next()){t=e.timeout<0?this._execute(e):this._schedule(e);if(!t)break}return e||this.fire("complete"),this},_execute:function(e){this._running=e._running=!0,this._executing=e,e.iterations--,this.fire(r,{callback:e});var t=this._running&&e.autoContinue;return this._running=e._running=!1,this._executing=!1,t},_schedule:function(t){return this._running=e.later(t.timeout,this,function(){this._execute(t)&&this.run()}),!1},isRunning:function(){return!!this._running},_defExecFn:function(e){e.callback()},add:function(){return this.fire("add",{callbacks:e.Array(arguments,0,!0)}),this},_defAddFn:function(t){var n=this._q,r=[];e.Array.each(t.callbacks,function(e){u(e)&&(n.push(e),r.push(e))}),t.added=r},pause:function(){return this._running&&u(this._running)&&this._running.cancel(),this._running=!1,this},stop:function(){return this._q=[],this._running&&u(this._running)&&(this._running.cancel(),this._running=!1),this._executing||this.run(),this},indexOf:function(e){var t=0,n=this._q.length,r;for(;t<n;++t){r=this._q[t];if(r===e||r.id===e)return t}return-1},getCallback:function(e){var t=this.indexOf(e);return t>-1?this._q[t]:null},promote:function(e){var t={callback:e},n;return this.isRunning()?n=this.after(i,function(){this.fire(s,t),n.detach()},this):this.fire(s,t),this},_defPromoteFn:function(e){var t=this.indexOf(e.callback),n=t>-1?this._q.splice(t,1)[0]:null;e.promoted=n,n&&this._q.unshift(n)},remove:function(e){var t={callback:e},n;return this.isRunning()?n=this.after(i,function(){this.fire(o,t),n.detach()},this):this.fire(o,t),this},_defRemoveFn:function(e){var t=this.indexOf(e.callback);e.removed=t>-1?this._q.splice(t,1)[0]:null},size:function(){return this.isRunning()||this.next(),this._q.length}})},"3.17.2",{requires:["event-custom"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("gesture-simulate",function(e,t){function T(n){n||e.error(t+": invalid target node"),this.node=n,this.target=e.Node.getDOMNode(n);var r=this.node.getXY(),i=this._getDims();a=r[0]+i[0]/2,f=r[1]+i[1]/2}var t="gesture-simulate",n=e.config.win&&"ontouchstart"in e.config.win&&!e.UA.phantomjs&&!(e.UA.chrome&&e.UA.chrome<6),r={tap:1,doubletap:1,press:1,move:1,flick:1,pinch:1,rotate:1},i={touchstart:1,touchmove:1,touchend:1,touchcancel:1},s=e.config.doc,o,u=20,a,f,l={HOLD_TAP:10,DELAY_TAP:10,HOLD_PRESS:3e3,MIN_HOLD_PRESS:1e3,MAX_HOLD_PRESS:6e4,DISTANCE_MOVE:200,DURATION_MOVE:1e3,MAX_DURATION_MOVE:5e3,MIN_VELOCITY_FLICK:1.3,DISTANCE_FLICK:200,DURATION_FLICK:1e3,MAX_DURATION_FLICK:5e3,DURATION_PINCH:1e3},c="touchstart",h="touchmove",p="touchend",d="gesturestart",v="gesturechange",m="gestureend",g="mouseup",y="mousemove",b="mousedown",w="click",E="dblclick",S="x",x="y";T.prototype={_toRadian:function(e){return e*(Math.PI/180)},_getDims:function(){var e,t,n;return this.target.getBoundingClientRect?(e=this.target.getBoundingClientRect(),"height"in e?n=e.height:n=Math.abs(e.bottom-e.top),"width"in e?t=e.width:t=Math.abs(e.right-e.left)):(e=this.node.get("region"),t=e.width,n=e.height),[t,n]},_calculateDefaultPoint:function(t){var n;return!e.Lang.isArray(t)||t.length===0?t=[a,f]:(t.length==1&&(n=this._getDims[1],t[1]=n/2),t[0]=this.node.getX()+t[0],t[1]=this.node.getY()+t[1]),t},rotate:function(n,r,i,s,o,u,a){var f,l=i,c=s;if(!e.Lang.isNumber(l)||!e.Lang.isNumber(c)||l<0||c<0)f=this.target.offsetWidth<this.target.offsetHeight?this.target.offsetWidth/4:this.target.offsetHeight/4,l=f,c=f;e.Lang.isNumber(a)||e.error(t+"Invalid rotation detected."),this.pinch(n,r,l,c,o,u,a)},pinch:function(n,r,i,s,o,a,f){var g,y,b=u,w,E=0,S=i,x=s,T,N,C,k,L,A,O,M,_,D={start:[],end:[]},P={start:[],end:[]},H,B;r=this._calculateDefaultPoint(r),(!e.Lang.isNumber(S)||!e.Lang.isNumber(x)||S<0||x<0)&&e.error(t+"Invalid startRadius and endRadius detected.");if(!e.Lang.isNumber(o)||o<=0)o=l.DURATION_PINCH;if(!e.Lang.isNumber(a))a=0;else{a%=360;while(a<0)a+=360}e.Lang.isNumber(f)||(f=0),e.AsyncQueue.defaults.timeout=b,g=new e.AsyncQueue,N=r[0],C=r[1],O=a,M=a+f,D.start=[N+S*Math.sin(this._toRadian(O)),C-S*Math.cos(this._toRadian(O))],D.end=[N+x*Math.sin(this._toRadian(M)),C-x*Math.cos(this._toRadian(M))],P.start=[N-S*Math.sin(this._toRadian(O)),C+S*Math.cos(this._toRadian(O))],P.end=[N-x*Math.sin(this._toRadian(M)),C+x*Math.cos(this._toRadian(M))],k=1,L=s/i,g.add({fn:function(){var t,n,r,i;t={pageX:D.start[0],pageY:D.start[1],clientX:D.start[0],clientY:D.start[1]},n={pageX:P.start[0],pageY:P.start[1],clientX:P.start[0],clientY:P.start[1]},i=this._createTouchList([e.merge({identifier:E++},t),e.merge({identifier:E++},n)]),r={pageX:(D.start[0]+P.start[0])/2,pageY:(D.start[0]+P.start[1])/2,clientX:(D.start[0]+P.start[0])/2,clientY:(D.start[0]+P.start[1])/2},this._simulateEvent(this.target,c,e.merge({touches:i,targetTouches:i,changedTouches:i,scale:k,rotation:O},r)),e.UA.ios>=2&&this._simulateEvent(this.target,d,e.merge({scale:k,rotation:O},r))},timeout:0,context:this}),H=Math.floor(o/b),T=(x-S)/H,A=(L-k)/H,_=(M-O)/H,B=function(t){var n=S+T*t,r=N+n*Math.sin(this._toRadian(O+_*t)),i=C-n*Math.cos(this._toRadian(O+_*t)),s=N-n*Math.sin(this._toRadian(O+_*t)),o=C+n*Math.cos(this._toRadian(O+_*t)),u=(r+s)/2,a=(i+o)/2,f,l,c,p;f={pageX:r,pageY:i,clientX:r,clientY:i},l={pageX:s,pageY:o,clientX:s,clientY:o},p=this._createTouchList([e.merge({identifier:E++},f),e.merge({identifier:E++},l)]),c={pageX:u,pageY:a,clientX:u,clientY:a},this._simulateEvent(this.target,h,e.merge({touches:p,targetTouches:p,changedTouches:p,scale:k+A*t,rotation:O+_*t},c)),e.UA.ios>=2&&this._simulateEvent(this.target,v,e.merge({scale:k+A*t,rotation:O+_*t},c))};for(y=0;y<H;y++)g.add({fn:B,args:[y],context:this});g.add({fn:function(){var t=this._getEmptyTouchList(),n,r,i,s;n={pageX:D.end[0],pageY:D.end[1],clientX:D.end[0],clientY:D.end[1]},r={pageX:P.end[0],pageY:P.end[1],clientX:P.end[0],clientY:P.end[1]},s=this._createTouchList([e.merge({identifier:E++},n),e.merge({identifier:E++},r)]),i={pageX:(D.end[0]+P.end[0])/2,pageY:(D.end[0]+P.end[1])/2,clientX:(D.end[0]+P.end[0])/2,clientY:(D.end[0]+P.end[1])/2},e.UA.ios>=2&&this._simulateEvent(this.target,m,e.merge({scale:L,rotation:M},i)),this._simulateEvent(this.target,p,e.merge({touches:t,targetTouches:t,changedTouches:s,scale:L,rotation:M},i))},context:this}),n&&e.Lang.isFunction(n)&&g.add({fn:n,context:this.node}),g.run()},tap:function(t,r,i,s,o){var u=new e.AsyncQueue,a=this._getEmptyTouchList(),f,h,d,v,m;r=this._calculateDefaultPoint(r);if(!e.Lang.isNumber(i)||i<1)i=1;e.Lang.isNumber(s)||(s=l.HOLD_TAP),e.Lang.isNumber(o)||(o=l.DELAY_TAP),h={pageX:r[0],pageY:r[1],clientX:r[0],clientY:r[1]},f=this._createTouchList([e.merge({identifier:0},h)]),v=function(){this._simulateEvent(this.target,c,e.merge({touches:f,targetTouches:f,changedTouches:f},h))},m=function(){this._simulateEvent(this.target,p,e.merge({touches:a,targetTouches:a,changedTouches:f},h))};for(d=0;d<i;d++)u.add({fn:v,context:this,timeout:d===0?0:o}),u.add({fn:m,context:this,timeout:s});i>1&&!n&&u.add({fn:function(){this._simulateEvent(this.target,E,h)},context:this}),t&&e.Lang.isFunction(t)&&u.add({fn:t,context:this.node}),u.run()},flick:function(n,r,i,s,o){var u;r=this._calculateDefaultPoint(r),e.Lang.isString(i)?(i=i.toLowerCase(),i!==S&&i!==x&&e.error(t+"(flick): Only x or y axis allowed")):i=S,e.Lang.isNumber(s)||(s=l.DISTANCE_FLICK),e.Lang.isNumber(o)?o>l.MAX_DURATION_FLICK&&(o=l.MAX_DURATION_FLICK):o=l.DURATION_FLICK,Math.abs(s)/o<l.MIN_VELOCITY_FLICK&&(o=Math.abs(s)/l.MIN_VELOCITY_FLICK),u={start:e.clone(r),end:[i===S?r[0]+s:r[0],i===x?r[1]+s:r[1]]},this._move(n,u,o)},move:function(t,n,r){var i;e.Lang.isObject(n)?(e.Lang.isArray(n.point)?n.point=this._calculateDefaultPoint(n.point):n.point=this._calculateDefaultPoint([]),e.Lang.isNumber(n.xdist)||(n.xdist=l.DISTANCE_MOVE),e.Lang.isNumber(n.ydist)||(n.ydist=0)):n={point:this._calculateDefaultPoint([]),xdist:l.
DISTANCE_MOVE,ydist:0},e.Lang.isNumber(r)?r>l.MAX_DURATION_MOVE&&(r=l.MAX_DURATION_MOVE):r=l.DURATION_MOVE,i={start:e.clone(n.point),end:[n.point[0]+n.xdist,n.point[1]+n.ydist]},this._move(t,i,r)},_move:function(t,n,r){var i,s,o=u,d,v,m,g=0,y;e.Lang.isNumber(r)?r>l.MAX_DURATION_MOVE&&(r=l.MAX_DURATION_MOVE):r=l.DURATION_MOVE,e.Lang.isObject(n)?(e.Lang.isArray(n.start)||(n.start=[a,f]),e.Lang.isArray(n.end)||(n.end=[a+l.DISTANCE_MOVE,f])):n={start:[a,f],end:[a+l.DISTANCE_MOVE,f]},e.AsyncQueue.defaults.timeout=o,i=new e.AsyncQueue,i.add({fn:function(){var t={pageX:n.start[0],pageY:n.start[1],clientX:n.start[0],clientY:n.start[1]},r=this._createTouchList([e.merge({identifier:g++},t)]);this._simulateEvent(this.target,c,e.merge({touches:r,targetTouches:r,changedTouches:r},t))},timeout:0,context:this}),d=Math.floor(r/o),v=(n.end[0]-n.start[0])/d,m=(n.end[1]-n.start[1])/d,y=function(t){var r=n.start[0]+v*t,i=n.start[1]+m*t,s={pageX:r,pageY:i,clientX:r,clientY:i},o=this._createTouchList([e.merge({identifier:g++},s)]);this._simulateEvent(this.target,h,e.merge({touches:o,targetTouches:o,changedTouches:o},s))};for(s=0;s<d;s++)i.add({fn:y,args:[s],context:this});i.add({fn:function(){var t={pageX:n.end[0],pageY:n.end[1],clientX:n.end[0],clientY:n.end[1]},r=this._createTouchList([e.merge({identifier:g},t)]);this._simulateEvent(this.target,h,e.merge({touches:r,targetTouches:r,changedTouches:r},t))},timeout:0,context:this}),i.add({fn:function(){var t={pageX:n.end[0],pageY:n.end[1],clientX:n.end[0],clientY:n.end[1]},r=this._getEmptyTouchList(),i=this._createTouchList([e.merge({identifier:g},t)]);this._simulateEvent(this.target,p,e.merge({touches:r,targetTouches:r,changedTouches:i},t))},context:this}),t&&e.Lang.isFunction(t)&&i.add({fn:t,context:this.node}),i.run()},_getEmptyTouchList:function(){return o||(o=this._createTouchList([])),o},_createTouchList:function(n){var r=[],i,o=this;return!!n&&e.Lang.isArray(n)?e.UA.android&&e.UA.android>=4||e.UA.ios&&e.UA.ios>=2?(e.each(n,function(t){t.identifier||(t.identifier=0),t.pageX||(t.pageX=0),t.pageY||(t.pageY=0),t.screenX||(t.screenX=0),t.screenY||(t.screenY=0),r.push(s.createTouch(e.config.win,o.target,t.identifier,t.pageX,t.pageY,t.screenX,t.screenY))}),i=s.createTouchList.apply(s,r)):e.UA.ios&&e.UA.ios<2?e.error(t+": No touch event simulation framework present."):(i=[],e.each(n,function(e){e.identifier||(e.identifier=0),e.clientX||(e.clientX=0),e.clientY||(e.clientY=0),e.pageX||(e.pageX=0),e.pageY||(e.pageY=0),e.screenX||(e.screenX=0),e.screenY||(e.screenY=0),i.push({target:o.target,identifier:e.identifier,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY})}),i.item=function(e){return i[e]}):e.error(t+": Invalid touchPoints passed"),i},_simulateEvent:function(t,r,s){var o;i[r]?n?e.Event.simulate(t,r,s):this._isSingleTouch(s.touches,s.targetTouches,s.changedTouches)?(r={touchstart:b,touchmove:y,touchend:g}[r],s.button=0,s.relatedTarget=null,o=r===g?s.changedTouches:s.touches,s=e.mix(s,{screenX:o.item(0).screenX,screenY:o.item(0).screenY,clientX:o.item(0).clientX,clientY:o.item(0).clientY},!0),e.Event.simulate(t,r,s),r==g&&e.Event.simulate(t,w,s)):e.error("_simulateEvent(): Event '"+r+"' has multi touch objects that can't be simulated in your platform."):e.Event.simulate(t,r,s)},_isSingleTouch:function(e,t,n){return e&&e.length<=1&&t&&t.length<=1&&n&&n.length<=1}},e.GestureSimulation=T,e.GestureSimulation.defaults=l,e.GestureSimulation.GESTURES=r,e.Event.simulateGesture=function(n,i,s,o){n=e.one(n);var u=new e.GestureSimulation(n);i=i.toLowerCase(),!o&&e.Lang.isFunction(s)&&(o=s,s={}),s=s||{};if(r[i])switch(i){case"tap":u.tap(o,s.point,s.times,s.hold,s.delay);break;case"doubletap":u.tap(o,s.point,2);break;case"press":e.Lang.isNumber(s.hold)?s.hold<l.MIN_HOLD_PRESS?s.hold=l.MIN_HOLD_PRESS:s.hold>l.MAX_HOLD_PRESS&&(s.hold=l.MAX_HOLD_PRESS):s.hold=l.HOLD_PRESS,u.tap(o,s.point,1,s.hold);break;case"move":u.move(o,s.path,s.duration);break;case"flick":u.flick(o,s.point,s.axis,s.distance,s.duration);break;case"pinch":u.pinch(o,s.center,s.r1,s.r2,s.duration,s.start,s.rotation);break;case"rotate":u.rotate(o,s.center,s.r1,s.r2,s.duration,s.start,s.rotation)}else e.error(t+": Not a supported gesture simulation: "+i)}},"3.17.2",{requires:["async-queue","event-simulate","node-screen"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("node-event-simulate",function(e,t){e.Node.prototype.simulate=function(t,n){e.Event.simulate(e.Node.getDOMNode(this),t,n)},e.Node.prototype.simulateGesture=function(t,n,r){e.Event.simulateGesture(this,t,n,r)}},"3.17.2",{requires:["node-base","event-simulate","gesture-simulate"]});
YUI.add("moodle-core-notification-confirm",function(e,t){var n,r,i,s,o,u,a;n="moodle-dialogue",r="notificationBase",i="yesLabel",s="noLabel",o="title",u="question",a={BASE:"moodle-dialogue-base",WRAP:"moodle-dialogue-wrap",HEADER:"moodle-dialogue-hd",BODY:"moodle-dialogue-bd",CONTENT:"moodle-dialogue-content",FOOTER:"moodle-dialogue-ft",HIDDEN:"hidden",LIGHTBOX:"moodle-dialogue-lightbox"},M.core=M.core||{};var f="Moodle confirmation dialogue",l;l=function(e){l.superclass.constructor.apply(this,[e])},e.extend(l,M.core.notification.info,{_closeEvents:null,_yesButton:null,_noButton:null,_question:null,initializer:function(){this._closeEvents=[],this.publish("complete"),this.publish("complete-yes"),this.publish("complete-no"),this._yesButton=e.Node.create('<input type="button" class="btn btn-primary" id="id_yuiconfirmyes-'+this.get("COUNT")+'" value="'+this.get(i)+'" />'),this._noButton=e.Node.create('<input type="button" class="btn btn-secondary" id="id_yuiconfirmno-'+this.get("COUNT")+'" value="'+this.get(s)+'" />'),this._question=e.Node.create('<div class="confirmation-message">'+this.get(u)+"</div>");var t=e.Node.create('<div class="confirmation-dialogue"></div>').append(this._question).append(e.Node.create('<div class="confirmation-buttons form-inline justify-content-around"></div>').append(this._yesButton).append(this._noButton));this.get(r).addClass("moodle-dialogue-confirm"),this.setStdModContent(e.WidgetStdMod.BODY,t,e.WidgetStdMod.REPLACE),this.setStdModContent(e.WidgetStdMod.HEADER,'<h1 id="moodle-dialogue-'+this.get("COUNT")+'-header-text">'+this.get(o)+"</h1>",e.WidgetStdMod.REPLACE),this._closeEvents.push(e.on("key",this.submit,window,"down:27",this,!1),this._yesButton.on("click",this.submit,this,!0),this._noButton.on("click",this.submit,this,!1));var n=this.get("boundingBox").one(".closebutton");n&&this._closeEvents.push(n.on("click",this.submit,this))},submit:function(t,n){(new e.EventHandle(this._closeEvents)).detach(),this.fire("complete",n),n?this.fire("complete-yes"):this.fire("complete-no"),this.hide(),this.destroy()}},{NAME:f,CSS_PREFIX:n,ATTRS:{yesLabel:{validator:e.Lang.isString,valueFn:function(){return M.util.get_string("yes","moodle")},setter:function(e){return this._yesButton&&this._yesButton.set("value",e),e}},noLabel:{validator:e.Lang.isString,valueFn:function(){return M.util.get_string("no","moodle")},setter:function(e){return this._noButton&&this._noButton.set("value",e),e}},title:{validator:e.Lang.isString,value:M.util.get_string("confirm","moodle")},question:{validator:e.Lang.isString,valueFn:function(){return M.util.get_string("areyousure","moodle")},setter:function(e){return this._question&&this._question.set("value",e),e}}}}),e.augment(l,e.EventTarget),M.core.confirm=l},"@VERSION@",{requires:["moodle-core-notification-dialogue"]});
(function(e,t){t.rangy=e()})(function(){function u(n,r){var i=typeof n[r];return i==t||i==e&&!!n[r]||i=="unknown"}function a(t,n){return typeof t[n]==e&&!!t[n]}function f(e,t){return typeof e[t]!=n}function l(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return!1;return!0}}function d(e){return e&&c(e,o)&&p(e,s)}function v(e){return a(e,"body")?e.body:e.getElementsByTagName("body")[0]}function E(e){typeof console!=n&&u(console,"log")&&console.log(e)}function S(e,t){y&&t?alert(e):E(e)}function x(e){w.initialized=!0,w.supported=!1,S("Rangy is not supported in this environment. Reason: "+e,w.config.alertOnFail)}function T(e){S("Rangy warning: "+e,w.config.alertOnWarn)}function L(e){return e.message||e.description||String(e)}function A(){if(!y||w.initialized)return;var e,t=!1,n=!1;u(document,"createRange")&&(e=document.createRange(),c(e,i)&&p(e,r)&&(t=!0));var s=v(document);if(!s||s.nodeName.toLowerCase()!="body"){x("No body element found");return}s&&u(s,"createTextRange")&&(e=s.createTextRange(),d(e)&&(n=!0));if(!t&&!n){x("Neither Range nor TextRange are available");return}w.initialized=!0,w.features={implementsDomRange:t,implementsTextRange:n};var o,a;for(var f in g)(o=g[f])instanceof P&&o.init(o,w);for(var l=0,h=k.length;l<h;++l)try{k[l](w)}catch(m){a="Rangy init listener threw an exception. Continuing. Detail: "+L(m),E(a)}}function O(e,t,n){n&&(e+=" in module "+n.name),w.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function M(e,t,n,r){e[t]=function(){return O(t,n,r),e[n].apply(e,b.toArray(arguments))}}function D(e){e=e||window,A();for(var t=0,n=_.length;t<n;++t)_[t](e)}function P(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function H(e,t,n){var r=new P(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(w,t),t.supported=!0}catch(r){var i="Module '"+e+"' failed to load: "+L(r);E(i),r.stack&&E(r.stack)}}});return g[e]=r,r}function B(){}function j(){}var e="object",t="function",n="undefined",r=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],i=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],o=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],c=l(u),h=l(a),p=l(f),m=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)},g={},y=typeof window!=n&&typeof document!=n,b={isHostMethod:u,isHostObject:a,isHostProperty:f,areHostMethods:c,areHostObjects:h,areHostProperties:p,isTextRange:d,getBody:v,forEach:m},w={version:"1.3.0",initialized:!1,isBrowser:y,supported:!0,util:b,features:{},modules:g,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==n?!0:rangyAutoInitialize}};w.fail=x,w.warn=T;var N;(({})).hasOwnProperty?(b.extend=N=function(e,t,n){var r,i;for(var s in t)t.hasOwnProperty(s)&&(r=e[s],i=t[s],n&&r!==null&&typeof r=="object"&&i!==null&&typeof i=="object"&&N(r,i,!0),e[s]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},b.createOptions=function(e,t){var n={};return N(n,t),e&&N(n,e),n}):x("hasOwnProperty not supported"),y||x("Rangy can only run in a browser"),function(){var e;if(y){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{n.call(t.childNodes,0)[0].nodeType==1&&(e=function(e){return n.call(e,0)})}catch(r){}}e||(e=function(e){var t=[];for(var n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),b.toArray=e}();var C;y&&(u(document,"addEventListener")?C=function(e,t,n){e.addEventListener(t,n,!1)}:u(document,"attachEvent")?C=function(e,t,n){e.attachEvent("on"+t,n)}:x("Document does not have required addEventListener or attachEvent method"),b.addListener=C);var k=[];b.deprecationNotice=O,b.createAliasForDeprecatedMethod=M,w.init=A,w.addInitListener=function(e){w.initialized?e(w):k.push(e)};var _=[];w.addShimListener=function(e){_.push(e)},y&&(w.shim=w.createMissingNativeApi=D,M(w,"createMissingNativeApi","shim")),P.prototype={init:function(){var e=this.dependencies||[];for(var t=0,n=e.length,r,i;t<n;++t){i=e[t],r=g[i];if(!r||!(r instanceof P))throw new Error("required module '"+i+"' not found");r.init();if(!r.supported)throw new Error("required module '"+i+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){w.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){w.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},w.createModule=function(e){var t,n;arguments.length==2?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=H(e,n,t);w.initialized&&w.supported&&r.init()},w.createCoreModule=function(e,t,n){H(e,t,n)},w.RangePrototype=B,w.rangePrototype=new B,w.selectionPrototype=new j,w.createCoreModule("DomUtil",[],function(e,t){function a(e){var t;return typeof e.namespaceURI==n||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function f(e){var t=e.parentNode;return t.nodeType==1?t:null}function l(e){var t=0;while(e=e.previousSibling)++t;return t}function c(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function h(e,t){var n=[],r;for(r=e;r;r=r.parentNode)n.push(r);for(r=t;r;r=r.parentNode)if(u(n,r))return r;return null}function p(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return!0;r=r.parentNode}return!1}function d(e,t){return p(e,t,!0)}function v(e,t,n){var r,i=n?e:e.parentNode;while(i){r=i.parentNode;if(r===t)return i;i=r}return null
}function m(e){var t=e.nodeType;return t==3||t==4||t==8}function g(e){if(!e)return!1;var t=e.nodeType;return t==3||t==8}function y(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function b(e,t,n){var r=e.cloneNode(!1);r.deleteData(0,t),e.deleteData(t,e.length-t),y(r,e);if(n)for(var i=0,s;s=n[i++];)s.node==e&&s.offset>t?(s.node=r,s.offset-=t):s.node==e.parentNode&&s.offset>l(e)&&++s.offset;return r}function w(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return w(e.parentNode);throw t.createError("getDocument: no document found for node")}function E(e){var r=w(e);if(typeof r.defaultView!=n)return r.defaultView;if(typeof r.parentWindow!=n)return r.parentWindow;throw t.createError("Cannot get a window object for node")}function S(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function x(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function T(e){return e&&r.isHostMethod(e,"setTimeout")&&r.isHostObject(e,"document")}function N(e,t,n){var i;e?r.isHostProperty(e,"nodeType")?i=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?S(e):w(e):T(e)&&(i=e.document):i=document;if(!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function C(e){var t;while(t=e.parentNode)e=t;return e}function k(e,n,r,i){var s,o,u,a,f;if(e==r)return n===i?0:n<i?-1:1;if(s=v(r,e,!0))return n<=l(s)?-1:1;if(s=v(e,r,!0))return l(s)<i?-1:1;o=h(e,r);if(!o)throw new Error("comparePoints error: nodes have no common ancestor");u=e===o?o:v(e,o,!0),a=r===o?o:v(r,o,!0);if(u===a)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");f=o.firstChild;while(f){if(f===u)return-1;if(f===a)return 1;f=f.nextSibling}}function A(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function O(e){if(!e)return"[No node]";if(L&&A(e))return"[Broken node]";if(m(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+l(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function M(e){var t=w(e).createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t}function D(e,t,n){var r=i(e),s=e.createElement("div");s.contentEditable=""+!!n,t&&(s.innerHTML=t);var o=r.firstChild;return o?r.insertBefore(s,o):r.appendChild(s),s}function P(e){return e.parentNode.removeChild(e)}function H(e){this.root=e,this._next=e}function B(e){return new H(e)}function j(e,t){this.node=e,this.offset=t}function F(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var n="undefined",r=e.util,i=r.getBody;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var s=document.createElement("div");r.areHostMethods(s,["insertBefore","appendChild","cloneNode"]||!r.areHostObjects(s,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),r.isHostProperty(s,"innerHTML")||t.fail("Element is missing innerHTML property");var o=document.createTextNode("test");r.areHostMethods(o,["splitText","deleteData","insertData","appendData","cloneNode"]||!r.areHostObjects(s,["previousSibling","nextSibling","childNodes","parentNode"])||!r.areHostProperties(o,["data"]))||t.fail("Incomplete Text Node implementation");var u=function(e,t){var n=e.length;while(n--)if(e[n]===t)return!0;return!1},L=!1;(function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",L=A(n),e.features.crashyTextNodes=L})();var _;typeof window.getComputedStyle!=n?_=function(e,t){return E(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?_=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),H.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next,t,n;if(this._current){t=e.firstChild;if(t)this._next=t;else{n=null;while(e!==this.root&&!(n=e.nextSibling))e=e.parentNode;this._next=n}}return this._current},detach:function(){this._current=this._next=this.root=null}},j.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+O(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},F.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},F.prototype.toString=function(){return this.message},e.dom={arrayContains:u,isHtmlNamespace:a,parentElement:f,getNodeIndex:l,getNodeLength:c,getCommonAncestor:h,isAncestorOf:p,isOrIsAncestorOf:d,getClosestAncestorIn:v,isCharacterDataNode:m,isTextOrCommentNode:g,insertAfter:y,splitDataNode:b,getDocument:w,getWindow:E,getIframeWindow:x,getIframeDocument:S,getBody:i,isWindow:T,getContentDocument:N,getRootContainer:C,comparePoints:k,isBrokenNode:A,inspectNode:O,getComputedStyleProperty:_,createTestElement:D,removeNode:P,fragmentFromNodeChildren:M,createIterator:B,DomPosition:j},e.DOMException=F}),w.createCoreModule("DomRange",["DomUtil"],function(e,t){function y(e,t){return e.nodeType!=3&&(a(e,t.startContainer)||a(e,t.endContainer))}function b(e){return e.document||f(e.startContainer)}function w(e){return v(e.startContainer)}function E(e){return new i(e.parentNode,u(e))}function S(e){return new i(e.parentNode,u
(e)+1)}function x(e,t,r){var i=e.nodeType==11?e.firstChild:e;return o(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,r==0?t:c(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function T(e,t,n){K(e),K(t);if(b(t)!=b(e))throw new s("WRONG_DOCUMENT_ERR");var r=l(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=l(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function N(e){var t;for(var n,r=b(e.range).createDocumentFragment(),i;n=e.next();){t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(N(i)),i.detach());if(n.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");r.appendChild(n)}return r}function C(e,t,r){var i,s;r=r||{stop:!1};for(var o,u;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1){r.stop=!0;return}u=e.getSubtreeIterator(),C(u,t,r),u.detach();if(r.stop)return}else{i=n.createIterator(o);while(s=i.next())if(t(s)===!1){r.stop=!0;return}}}function k(e){var t;while(e.next())e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),k(t),t.detach()):e.remove()}function L(e){for(var t,n=b(e.range).createDocumentFragment(),r;t=e.next();){e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(L(r)),r.detach()):e.remove();if(t.nodeType==10)throw new s("HIERARCHY_REQUEST_ERR");n.appendChild(t)}return n}function A(e,t,n){var r=!!t&&!!t.length,i,s=!!n;r&&(i=new RegExp("^("+t.join("|")+")$"));var u=[];return C(new M(e,!1),function(t){if(r&&!i.test(t.nodeType))return;if(s&&!n(t))return;var a=e.startContainer;if(t==a&&o(a)&&e.startOffset==a.length)return;var f=e.endContainer;if(t==f&&o(f)&&e.endOffset==0)return;u.push(t)}),u}function O(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function M(e,t){this.range=e,this.clonePartiallySelectedTextNodes=t;if(!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&o(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===n&&!o(this.sc)?this.sc.childNodes[this.so]:h(this.sc,n,!0),this._last=this.ec===n&&!o(this.ec)?this.ec.childNodes[this.eo-1]:h(this.ec,n,!0))}}function j(e){return function(t,n){var r,i=n?t:t.parentNode;while(i){r=i.nodeType;if(d(e,r))return i;i=i.parentNode}return null}}function R(e,t){if(q(e,t))throw new s("INVALID_NODE_TYPE_ERR")}function U(e,t){if(!d(t,e.nodeType))throw new s("INVALID_NODE_TYPE_ERR")}function z(e,t){if(t<0||t>(o(e)?e.length:e.childNodes.length))throw new s("INDEX_SIZE_ERR")}function W(e,t){if(F(e,!0)!==F(t,!0))throw new s("WRONG_DOCUMENT_ERR")}function X(e){if(I(e,!0))throw new s("NO_MODIFICATION_ALLOWED_ERR")}function V(e,t){if(!e)throw new s(t)}function $(e,t){return t<=(o(e)?e.length:e.childNodes.length)}function J(e){return!!e.startContainer&&!!e.endContainer&&(!m||!n.isBrokenNode(e.startContainer)&&!n.isBrokenNode(e.endContainer))&&v(e.startContainer)==v(e.endContainer)&&$(e.startContainer,e.startOffset)&&$(e.endContainer,e.endOffset)}function K(e){if(!J(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function et(e,t){K(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,a=n===i;o(i)&&s>0&&s<i.length&&c(i,s,t),o(n)&&r>0&&r<n.length&&(n=c(n,r,t),a?(s-=r,i=n):i==n.parentNode&&s>=u(n)&&s++,r=0),e.setStartAndEnd(n,r,i,s)}function tt(e){K(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function ct(e){e.START_TO_START=rt,e.START_TO_END=it,e.END_TO_END=st,e.END_TO_START=ot,e.NODE_BEFORE=ut,e.NODE_AFTER=at,e.NODE_BEFORE_AND_AFTER=ft,e.NODE_INSIDE=lt}function ht(e){ct(e),ct(e.prototype)}function pt(e,t){return function(){K(this);var n=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer,s=new M(this,!0),o,u;n!==i&&(o=h(n,i,!0),u=S(o),n=u.node,r=u.offset),C(s,X),s.reset();var a=e(s);return s.detach(),t(this,n,r,n,r),a}}function dt(t,n){function i(e,t){return function(n){U(n,_),U(v(n),D);var r=(e?E:S)(n);(t?s:a)(this,r.node,r.offset)}}function s(e,t,r){var i=e.endContainer,s=e.endOffset;if(t!==e.startContainer||r!==e.startOffset){if(v(t)!=v(i)||l(t,r,i,s)==1)i=t,s=r;n(e,t,r,i,s)}}function a(e,t,r){var i=e.startContainer,s=e.startOffset;if(t!==e.endContainer||r!==e.endOffset){if(v(t)!=v(i)||l(t,r,i,s)==-1)i=t,s=r;n(e,i,s,t,r)}}var f=function(){};f.prototype=e.rangePrototype,t.prototype=new f,r.extend(t.prototype,{setStart:function(e,t){R(e,!0),z(e,t),s(this,e,t)},setEnd:function(e,t){R(e,!0),z(e,t),a(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],r=e[1],i=t,s=r;switch(e.length){case 3:s=e[2];break;case 4:i=e[2],s=e[3]}n(this,t,r,i,s)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){K(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){R(e,!0),n(this,e,0,e,p(e))},selectNode:function(e){R(e,!1),U(e,_);var t=E(e),r=S(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:pt(L,n),deleteContents:pt(k,n),canSurroundContents:function(){K(this),X(this.startContainer),X(this.endContainer);var e=new M(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},splitBoundaries:function(){et(this)},splitBoundariesPreservingPositions:function(e){et(this,e)},normalizeBoundaries:function(){K(this);var e=this.startContainer,t=this.startOffset,r=this.endContainer,i=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(r=e,i=e.length,e.appendData(t.data),g(t))},a=function(
n){var s=n.previousSibling;if(s&&s.nodeType==n.nodeType){e=n;var o=n.length;t=s.length,n.insertData(0,s.data),g(s);if(e==r)i+=t,r=e;else if(r==n.parentNode){var a=u(n);i==a?(r=n,i=o):i>a&&i--}}},f=!0,l;if(o(r))i==r.length?s(r):i==0&&(l=r.previousSibling,l&&l.nodeType==r.nodeType&&(i=l.length,e==r&&(f=!1),l.appendData(r.data),g(r),r=l));else{if(i>0){var c=r.childNodes[i-1];c&&o(c)&&s(c)}f=!this.collapsed}if(f){if(o(e))t==0?a(e):t==e.length&&(l=e.nextSibling,l&&l.nodeType==e.nodeType&&(r==l&&(r=e,i+=e.length),e.appendData(l.data),g(l)));else if(t<e.childNodes.length){var h=e.childNodes[t];h&&o(h)&&a(h)}}else e=r,t=i;n(this,e,t,r,i)},collapseToPoint:function(e,t){R(e,!0),z(e,t),this.setStartAndEnd(e,t)}}),ht(t)}function vt(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function mt(e,t,r,i,s){e.startContainer=t,e.startOffset=r,e.endContainer=i,e.endOffset=s,e.document=n.getDocument(t),vt(e)}function gt(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,vt(this)}var n=e.dom,r=e.util,i=n.DomPosition,s=e.DOMException,o=n.isCharacterDataNode,u=n.getNodeIndex,a=n.isOrIsAncestorOf,f=n.getDocument,l=n.comparePoints,c=n.splitDataNode,h=n.getClosestAncestorIn,p=n.getNodeLength,d=n.arrayContains,v=n.getRootContainer,m=e.features.crashyTextNodes,g=n.removeNode;M.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,o(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e=this._current,t,n;!o(e)||e!==this.sc&&e!==this.ec?e.parentNode&&g(e):(t=e===this.sc?this.so:0,n=e===this.ec?this.eo:e.length,t!=n&&e.deleteData(t,n-t))},isPartiallySelectedSubtree:function(){var e=this._current;return y(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new gt(b(this.range));var t=this._current,n=t,r=0,i=t,s=p(t);a(t,this.sc)&&(n=this.sc,r=this.so),a(t,this.ec)&&(i=this.ec,s=this.eo),mt(e,n,r,i,s)}return new M(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var _=[1,3,4,5,7,8,10],D=[2,9,11],P=[5,6,10,12],H=[1,3,4,5,7,8,10,11],B=[1,3,4,5,7,8],F=j([9,11]),I=j(P),q=j([6,10,12]),Q=document.createElement("style"),G=!1;try{Q.innerHTML="<b>x</b>",G=Q.firstChild.nodeType==3}catch(Y){}e.features.htmlParsingConforms=G;var Z=G?function(e){var t=this.startContainer,r=f(t);if(!t)throw new s("INVALID_STATE_ERR");var i=null;return t.nodeType==1?i=t:o(t)&&(i=n.parentElement(t)),i===null||i.nodeName=="HTML"&&n.isHtmlNamespace(f(i).documentElement)&&n.isHtmlNamespace(i)?i=r.createElement("body"):i=i.cloneNode(!1),i.innerHTML=e,n.fragmentFromNodeChildren(i)}:function(e){var t=b(this),r=t.createElement("body");return r.innerHTML=e,n.fragmentFromNodeChildren(r)},nt=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],rt=0,it=1,st=2,ot=3,ut=0,at=1,ft=2,lt=3;r.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){K(this),W(this.startContainer,t.startContainer);var n,r,i,s,o=e==ot||e==rt?"start":"end",u=e==it||e==rt?"start":"end";return n=this[o+"Container"],r=this[o+"Offset"],i=t[u+"Container"],s=t[u+"Offset"],l(n,r,i,s)},insertNode:function(e){K(this),U(e,H),X(this.startContainer);if(a(e,this.startContainer))throw new s("HIERARCHY_REQUEST_ERR");var t=x(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){K(this);var e,t;if(this.collapsed)return b(this).createDocumentFragment();if(this.startContainer===this.endContainer&&o(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=b(this).createDocumentFragment(),t.appendChild(e),t;var n=new M(this,!0);return e=N(n),n.detach(),e},canSurroundContents:function(){K(this),X(this.startContainer),X(this.endContainer);var e=new M(this,!0),t=e._first&&y(e._first,this)||e._last&&y(e._last,this);return e.detach(),!t},surroundContents:function(e){U(e,B);if(!this.canSurroundContents())throw new s("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())while(e.lastChild)e.removeChild(e.lastChild);x(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){K(this);var e=new gt(b(this)),t=nt.length,n;while(t--)n=nt[t],e[n]=this[n];return e},toString:function(){K(this);var e=this.startContainer;if(e===this.endContainer&&o(e))return e.nodeType==3||e.nodeType==4?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new M(this,!0);return C(n,function(e){(e.nodeType==3||e.nodeType==4)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){K(this);var t=e.parentNode,n=u(e);if(!t)throw new s("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return r<0?i>0?ft:ut:i>0?at:lt},comparePoint:function(e,t){return K(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)<0?-1:l(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){return tt(this)},intersectsNode:function(e,t){K(this);if(v(e)!=w(this))return!1;var n=e.parentNode,r=u(e);if(!n)return!0;var i=l(n,r,this.endContainer,this.endOffset),s=l(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&s>=0:i<0&&s>0},isPointInRange:function(e,t){return K(this),V(e,"HIERARCHY_REQUEST_ERR"),W(e,this.startContainer),l(e,t,this.startContainer,this.startOffset)>=0&&l(e,t,this.endContainer,this.endOffset
)<=0},intersectsRange:function(e){return T(this,e,!1)},intersectsOrTouchesRange:function(e){return T(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=l(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=l(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return t==-1&&r.setStart(e.startContainer,e.startOffset),n==1&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return l(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(e.startContainer,e.startOffset),l(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(e.endContainer,e.endOffset),t}throw new s("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==lt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,p(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return K(this),A(this,e,t)},getDocument:function(){return b(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=b(this),i=e.createRange(r);t=t||n.getBody(r),i.selectNodeContents(t);var s=this.intersection(i),o=0,u=0;return s&&(i.setEnd(s.startContainer,s.startOffset),o=i.toString().length,u=o+s.toString().length),{start:o,end:u,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);var r=[t],i,s=!1,o=!1,u,a,f;while(!o&&(i=r.pop()))if(i.nodeType==3)u=n+i.length,!s&&e.start>=n&&e.start<=u&&(this.setStart(i,e.start-n),s=!0),s&&e.end>=n&&e.end<=u&&(this.setEnd(i,e.end-n),o=!0),n=u;else{f=i.childNodes,a=f.length;while(a--)r.push(f[a])}},getName:function(){return"DomRange"},equals:function(e){return gt.rangesEqual(this,e)},isValid:function(){return J(this)},inspect:function(){return O(this)},detach:function(){}}),dt(gt,mt),r.extend(gt,{rangeProperties:nt,RangeIterator:M,copyComparisonConstants:ht,createPrototypeRange:dt,inspect:O,toHtml:tt,getRangeDocument:b,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=gt}),w.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,i=e.dom,s=e.util,o=i.DomPosition,u=e.DomRange,a=i.getBody,f=i.getContentDocument,l=i.isCharacterDataNode;e.features.implementsDomRange&&function(){function l(e){var t=o.length,n;while(t--)n=o[t],e[n]=e.nativeRange[n];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function c(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i,u=!e.equals(e.nativeRange);if(s||o||u)e.setEnd(r,i),e.setStart(t,n)}var r,o=u.rangeProperties,h;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,l(this)},u.createPrototypeRange(n,c),r=n.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),l(this)},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),l(this)},r.collapse=function(e){this.nativeRange.collapse(e),l(this)},r.cloneRange=function(){return new n(this.nativeRange.cloneRange())},r.refresh=function(){l(this)},r.toString=function(){return this.nativeRange.toString()};var p=document.createTextNode("test");a(document).appendChild(p);var d=document.createRange();d.setStart(p,0),d.setEnd(p,0);try{d.setStart(p,1),r.setStart=function(e,t){this.nativeRange.setStart(e,t),l(this)},r.setEnd=function(e,t){this.nativeRange.setEnd(e,t),l(this)},h=function(e){return function(t){this.nativeRange[e](t),l(this)}}}catch(v){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}l(this)},r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}l(this)},h=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}l(this)}}}r.setStartBefore=h("setStartBefore","setEndBefore"),r.setStartAfter=h("setStartAfter","setEndAfter"),r.setEndBefore=h("setEndBefore","setStartBefore"),r.setEndAfter=h("setEndAfter","setStartAfter"),r.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},d.selectNodeContents(p),d.setEnd(p,3);var m=document.createRange();m.selectNodeContents(p),m.setEnd(p,4),m.setStart(p,2),d.compareBoundaryPoints(d.START_TO_END,m)==-1&&d.compareBoundaryPoints(d.END_TO_START,m)==1?r.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var g=document.createElement("div");g.innerHTML="123";var y=g.firstChild,b=a(document);b.appendChild(g),d.setStart(y,1),d.setEnd(y,2),d.deleteContents(),y.data=="13"&&(r.deleteContents=function(){this.nativeRange.deleteContents(),l(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return l(this),e}),b.removeChild(g),b=null,s.isHostMethod(d,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),a(document).removeChild(p),r.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),e.createRange()}}();if(e.features.implementsTextRange){var c=function(
e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var s=n.parentElement(),o=r==s?r:i.getCommonAncestor(r,s);return o==t?o:i.getCommonAncestor(t,o)},h=function(e){return e.compareEndPoints("StartToEnd",e)==0},p=function(e,t,n,r,s){var u=e.duplicate();u.collapse(n);var a=u.parentElement();i.isOrIsAncestorOf(t,a)||(a=t);if(!a.canHaveHTML){var f=new o(a.parentNode,i.getNodeIndex(a));return{boundaryPosition:f,nodeInfo:{nodeIndex:f.offset,containerElement:f.node}}}var c=i.getDocument(a).createElement("span");c.parentNode&&i.removeNode(c);var h,p=n?"StartToStart":"StartToEnd",d,v,m,g,y=s&&s.containerElement==a?s.nodeIndex:0,b=a.childNodes.length,w=b,E=w;for(;;){E==b?a.appendChild(c):a.insertBefore(c,a.childNodes[E]),u.moveToElementText(c),h=u.compareEndPoints(p,e);if(h==0||y==w)break;if(h==-1){if(w==y+1)break;y=E}else w=w==y+1?y:E;E=Math.floor((y+w)/2),a.removeChild(c)}g=c.nextSibling;if(h==-1&&g&&l(g)){u.setEndPoint(n?"EndToStart":"EndToEnd",e);var S;if(/[\r\n]/.test(g.data)){var x=u.duplicate(),T=x.text.replace(/\r\n/g,"\r").length;S=x.moveStart("character",T);while((h=x.compareEndPoints("StartToEnd",x))==-1)S++,x.moveStart("character",1)}else S=u.text.length;m=new o(g,S)}else d=(r||!n)&&c.previousSibling,v=(r||n)&&c.nextSibling,v&&l(v)?m=new o(v,0):d&&l(d)?m=new o(d,d.data.length):m=new o(a,i.getNodeIndex(c));return i.removeNode(c),{boundaryPosition:m,nodeInfo:{nodeIndex:E,containerElement:a}}},d=function(e,t){var n,r,s=e.offset,o=i.getDocument(e.node),u,f,c=a(o).createTextRange(),h=l(e.node);return h?(n=e.node,r=n.parentNode):(f=e.node.childNodes,n=s<f.length?f[s]:null,r=e.node),u=o.createElement("span"),u.innerHTML="&#feff;",n?r.insertBefore(u,n):r.appendChild(u),c.moveToElementText(u),c.collapse(!t),r.removeChild(u),h&&c[t?"moveStart":"moveEnd"]("character",s),c};r=function(e){this.textRange=e,this.refresh()},r.prototype=new u(document),r.prototype.refresh=function(){var e,t,n,r=c(this.textRange);h(this.textRange)?t=e=p(this.textRange,r,!0,!0).boundaryPosition:(n=p(this.textRange,r,!0,!1),e=n.boundaryPosition,t=p(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},u.copyComparisonConstants(r);var v=function(e){if(e.collapsed)return d(new o(e.startContainer,e.startOffset),!0);var t=d(new o(e.startContainer,e.startOffset),!0),n=d(new o(e.endContainer,e.endOffset),!1),r=a(u.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};r.rangeToTextRange=v,r.prototype.toTextRange=function(){return v(this)},e.WrappedTextRange=r;if(!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);typeof m.Range=="undefined"&&(m.Range=r),e.createNativeRange=function(e){return e=f(e,t,"createNativeRange"),a(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=f(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=f(e,t,"createRangyRange"),new u(e)},s.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),s.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),w.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function y(e){return typeof e=="string"?/^backward(s)?$/i.test(e):!!e}function b(e,n){if(!e)return window;if(i.isWindow(e))return e;if(e instanceof J)return e.win;var r=i.getContentDocument(e,t,n);return i.getWindow(r)}function w(e){return b(e,"getWinSelection").getSelection()}function E(e){return b(e,"getDocSelection").document.selection}function S(e){var t=!1;return e.anchorNode&&(t=i.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1),t}function j(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function F(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function I(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function q(t){var n;return t instanceof u?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof a?n=t.nativeRange:p.implementsDomRange&&t instanceof i.getWindow(t.startContainer).Range&&(n=t),n}function R(e){if(!e.length||e[0].nodeType!=1)return!1;for(var t=1,n=e.length;t<n;++t)if(!i.isAncestorOf(e[0],e[t]))return!1;return!0}function U(e){var n=e.getNodes();if(!R(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function z(e){return!!e&&typeof e.text!="undefined"}function W(e,t){var n=new a(t);e._ranges=[n],j(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function X(t){t._ranges.length=0;if(t.docSelection.type=="None")I(t);else{var n=t.docSelection.createRange();if(z(n))W(t,n);else{t.rangeCount=n.length;var r,i=v(n.item(0));for(var s=0;s<t.rangeCount;++s)r=e.createRange(i),r.selectNode(n.item(s)),t._ranges.push(r);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed,j(t,t._ranges[t.rangeCount-1],!1)}}}function V(e,n){var r=e.docSelection.createRange(),i=U(n),s=v(r.item(0)),o=m(s).createControlRange();for(var u=0,a=r.length;u<a;++u)o.add(r.item(u));try{o.add(i)}catch(f){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),X(e)}function J(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function K(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=
e.focusOffset=0,e.detached=!0}function G(e,t){var n=Q.length,r,i;while(n--){r=Q[n],i=r.selection;if(t=="deleteAll")K(i);else if(r.win==e)return t=="delete"?(Q.splice(n,1),!0):i}return t=="deleteAll"&&(Q.length=0),null}function et(e,n){var r=v(n[0].startContainer),i=m(r).createControlRange();for(var s=0,o,u=n.length;s<u;++s){o=U(n[s]);try{i.add(o)}catch(a){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),X(e)}function st(e,t){if(e.win.document!=v(t))throw new f("WRONG_DOCUMENT_ERR")}function ot(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,r)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,r)),this.setSingleRange(i,this.isBackward())}}function ut(e){var t=[],n=new l(e.anchorNode,e.anchorOffset),r=new l(e.focusNode,e.focusOffset),i=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var s=0,o=e.rangeCount;s<o;++s)t[s]=u.inspect(e.getRangeAt(s));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var n="boolean",r="number",i=e.dom,s=e.util,o=s.isHostMethod,u=e.DomRange,a=e.WrappedRange,f=e.DOMException,l=i.DomPosition,c,h,p=e.features,d="Control",v=i.getDocument,m=i.getBody,g=u.rangesEqual,x=o(window,"getSelection"),T=s.isHostObject(document,"selection");p.implementsWinGetSelection=x,p.implementsDocSelection=T;var N=T&&(!x||e.config.preferTextRange);if(N)c=E,e.isSelectionValid=function(e){var t=b(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||v(n.createRange().parentElement())==t};else{if(!x)return t.fail("Neither document.selection or window.getSelection() detected."),!1;c=w,e.isSelectionValid=function(){return!0}}e.getNativeSelection=c;var C=c();if(!C)return t.fail("Native selection was null (possibly issue 138?)"),!1;var k=e.createNativeRange(document),L=m(document),A=s.areHostProperties(C,["anchorNode","focusNode","anchorOffset","focusOffset"]);p.selectionHasAnchorAndFocus=A;var O=o(C,"extend");p.selectionHasExtend=O;var M=typeof C.rangeCount==r;p.selectionHasRangeCount=M;var _=!1,D=!0,P=O?function(t,n){var r=u.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(q(i)),t.extend(n.startContainer,n.startOffset)}:null;s.areHostMethods(C,["addRange","getRangeAt","removeAllRanges"])&&typeof C.rangeCount==r&&p.implementsDomRange&&function(){var t=window.getSelection();if(t){var n=t.rangeCount,r=n>1,s=[],o=S(t);for(var u=0;u<n;++u)s[u]=t.getRangeAt(u);var a=i.createTestElement(document,"",!1),f=a.appendChild(document.createTextNode("\u00a0\u00a0\u00a0")),l=document.createRange();l.setStart(f,1),l.collapse(!0),t.removeAllRanges(),t.addRange(l),D=t.rangeCount==1,t.removeAllRanges();if(!r){var c=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(c&&parseInt(c[1])>=36)_=!1;else{var h=l.cloneRange();l.setStart(f,0),h.setEnd(f,3),h.setStart(f,2),t.addRange(l),t.addRange(h),_=t.rangeCount==2}}i.removeNode(a),t.removeAllRanges();for(u=0;u<n;++u)u==0&&o?P?P(t,s[u]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(s[u])):t.addRange(s[u])}}(),p.selectionSupportsMultipleRanges=_,p.collapsedNonEditableSelectionsSupported=D;var H=!1,B;L&&o(L,"createControlRange")&&(B=L.createControlRange(),s.areHostProperties(B,["item","add"])&&(H=!0)),p.implementsControlRange=H,A?h=function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:h=function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var $;o(C,"getRangeAt")?$=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:A&&($=function(t){var n=v(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),J.prototype=e.selectionPrototype;var Q=[],Y=function(e){if(e&&e instanceof J)return e.refresh(),e;e=b(e,"getNativeSelection");var t=G(e),n=c(e),r=T?E(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new J(n,r,e),Q.push({win:e,selection:t})),t};e.getSelection=Y,s.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var Z=J.prototype;if(!N&&A&&s.areHostMethods(C,["removeAllRanges","addRange"])){Z.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),I(this)};var tt=function(e,t){P(e.nativeSelection,t),e.refresh()};M?Z.addRange=function(t,n){if(H&&T&&this.docSelection.type==d)V(this,t);else if(y(n)&&O)tt(this,t);else{var r;_?r=this.rangeCount:(this.removeAllRanges(),r=0);var i=q(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(s){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==r+1){if(e.config.checkSelectionRanges){var o=$(this.nativeSelection,this.rangeCount-1);o&&!g(o,t)&&(t=new a(o))}this._ranges[this.rangeCount-1]=t,j(this,t,it(this.nativeSelection)),this.isCollapsed=h(this)}else this.refresh()}}:Z.addRange=function(e,t){y(t)&&O?tt(this,e):(this.nativeSelection.addRange(q(e)),this.refresh())},Z.setRanges=function(e){if(H&&T&&e.length>1)et(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(o(C,"empty")&&o(k,"select")&&H&&N))return t.fail("No means of selecting a Range or TextRange was found"),!1;Z.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode)e=v(this.anchorNode);else if(this.docSelection.type==d){var t=this.docSelection.createRange();t.length&&(e=v(t.item(0)))}if(e){var n=m(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}I(this)},Z.addRange=function(t){this.docSelection.type==d?V(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=
this._ranges[0].collapsed,j(this,t,!1))},Z.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?et(this,e):t&&this.addRange(e[0])}}Z.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new f("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var nt;if(N)nt=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=m(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==d?X(t):z(n)?W(t,n):I(t)};else if(o(C,"getRangeAt")&&typeof C.rangeCount==r)nt=function(t){if(H&&T&&t.docSelection.type==d)X(t);else{t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount;if(t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));j(t,t._ranges[t.rangeCount-1],it(t.nativeSelection)),t.isCollapsed=h(t)}else I(t)}};else{if(!A||typeof C.isCollapsed!=n||typeof k.collapsed!=n||!p.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;nt=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=$(n,0),e._ranges=[t],e.rangeCount=1,F(e),e.isCollapsed=h(e)):I(e)}}Z.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;nt(this);if(e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;while(i--)if(!g(t[i],this._ranges[i]))return!0;return!1}};var rt=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r)g(t,n[r])||e.addRange(n[r]);e.rangeCount||I(e)};H&&T?Z.removeRange=function(e){if(this.docSelection.type==d){var t=this.docSelection.createRange(),n=U(e),r=v(t.item(0)),i=m(r).createControlRange(),s,o=!1;for(var u=0,a=t.length;u<a;++u)s=t.item(u),s!==n||o?i.add(t.item(u)):o=!0;i.select(),X(this)}else rt(this,e)}:Z.removeRange=function(e){rt(this,e)};var it;!N&&A&&p.implementsDomRange?(it=S,Z.isBackward=function(){return it(this)}):it=Z.isBackward=function(){return!1},Z.isBackwards=Z.isBackward,Z.toString=function(){var e=[];for(var t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},Z.collapse=function(t,n){st(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},Z.collapseToStart=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},Z.collapseToEnd=function(){if(!this.rangeCount)throw new f("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},Z.selectAllChildren=function(t){st(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},Z.deleteFromDocument=function(){if(H&&T&&this.docSelection.type==d){var e=this.docSelection.createRange(),t;while(e.length)t=e.item(0),e.remove(t),i.removeNode(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,s=n.length;r<s;++r)n[r].deleteContents();this.addRange(n[s-1])}}},Z.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},Z.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},Z.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},Z.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t||[]))}),n},Z.setStart=ot(!0),Z.setEnd=ot(!1),e.rangePrototype.select=function(e){Y(this.getDocument()).setSingleRange(this,e)},Z.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&t.length==1?this.addRange(t[0],"backward"):this.setRanges(t)},Z.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},Z.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},Z.moveToBookmark=function(t){var n=[];for(var r=0,i,s;i=t.rangeBookmarks[r++];)s=e.createRange(this.win),s.moveToBookmark(i),n.push(s);t.backward?this.setSingleRange(n[0],"backward"):this.setRanges(n)},Z.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},Z.restoreRanges=function(e){this.removeAllRanges();for(var t=0,n;n=e.ranges[t];++t)this.addRange(n,e.backward&&t==0)},Z.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(u.toHtml(t))}),e.join("")},p.implementsTextRange&&(Z.getNativeTextRange=function(){var n,r;if(n=this.docSelection){var i=n.createRange();if(z(i))return i;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),Z.getName=function(){return"WrappedSelection"},Z.inspect=function(){return ut(this)},Z.detach=function(){G(this.win,"delete"),K(this)},J.detachAll=function(){G(null,"deleteAll")},J.inspect=ut,J.isDirectionBackward=y,e.Selection=J,e.selectionPrototype=Z,e.addShimListener(function(e){typeof e.getSelection=="undefined"&&(e.getSelection=function(){return Y(e)}),e=null})});var F=!1,I=function(e){F||(F=!0,!w.initialized&&w.config.autoInitialize&&A())};return y&&(document.readyState=="complete"?I():(u(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",I,!1),C(window,"load",I))),w},this),function(e,t){e(t.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,t){function o(e,t){return(t||document).getElementById(e)}function u(e,t){var r="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),i,o=n.getDocument(e.startContainer),u=e.cloneRange();return u.collapse(t),i=o.createElement("span"),i.id=r,i.style.lineHeight="0",i.style.display="none",i.className="rangySelectionBoundary",i.appendChild(o.createTextNode(s)),u.insertNode(i),i}function a(e,n,i,s){var u=o(i,e);u?(n[s?"setStartBefore":"setEndBefore"](u),r(u)):t.warn("Marker element has been removed. Cannot restore selection."
)}function f(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function l(t,n){var r,s,o=e.DomRange.getRangeDocument(t),a=t.toString(),f=i(n);return t.collapsed?(s=u(t,!1),{document:o,markerId:s.id,collapsed:!0}):(s=u(t,!1),r=u(t,!0),{document:o,startMarkerId:r.id,endMarkerId:s.id,collapsed:!1,backward:f,toString:function(){return"original text: '"+a+"', new text: '"+t.toString()+"'"}})}function c(n,i){var s=n.document;typeof i=="undefined"&&(i=!0);var u=e.createRange(s);if(n.collapsed){var f=o(n.markerId,s);if(f){f.style.display="inline";var l=f.previousSibling;l&&l.nodeType==3?(r(f),u.collapseToPoint(l,l.length)):(u.collapseBefore(f),r(f))}else t.warn("Marker element has been removed. Cannot restore selection.")}else a(s,u,n.startMarkerId,!0),a(s,u,n.endMarkerId,!1);return i&&u.normalizeBoundaries(),u}function h(t,n){var r=[],s,u,a=i(n);t=t.slice(0),t.sort(f);for(var c=0,h=t.length;c<h;++c)r[c]=l(t[c],a);for(c=h-1;c>=0;--c)s=t[c],u=e.DomRange.getRangeDocument(s),s.collapsed?s.collapseAfter(o(r[c].markerId,u)):(s.setEndBefore(o(r[c].endMarkerId,u)),s.setStartAfter(o(r[c].startMarkerId,u)));return r}function p(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=e.getSelection(n),i=r.getAllRanges(),s=i.length==1&&r.isBackward(),o=h(i,s);return s?r.setSingleRange(i[0],s):r.setRanges(i),{win:n,rangeInfos:o,restored:!1}}function d(e){var t=[],n=e.length;for(var r=n-1;r>=0;r--)t[r]=c(e[r],!0);return t}function v(t,n){if(!t.restored){var r=t.rangeInfos,i=e.getSelection(t.win),s=d(r),o=r.length;o==1&&n&&e.features.selectionHasExtend&&r[0].backward?(i.removeAllRanges(),i.addRange(s[0],!0)):i.setRanges(s),t.restored=!0}}function m(e,t){var n=o(t,e);n&&r(n)}function g(e){var t=e.rangeInfos;for(var n=0,r=t.length,i;n<r;++n)i=t[n],i.collapsed?m(e.doc,i.markerId):(m(e.doc,i.startMarkerId),m(e.doc,i.endMarkerId))}var n=e.dom,r=n.removeNode,i=e.Selection.isDirectionBackward,s="\ufeff";e.util.extend(e,{saveRange:l,restoreRange:c,saveRanges:h,restoreRanges:d,saveSelection:p,restoreSelection:v,removeMarkerElement:m,removeMarkers:g})}),e},this),function(e,t){e(t.rangy)}(function(e){return e.createModule("Serializer",["WrappedSelection"],function(e,t){function o(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(e,t){t=t||[];var n=e.nodeType,r=e.childNodes,i=r.length,s=[n,e.nodeName,i].join(":"),a="",f="";switch(n){case 3:a=o(e.nodeValue);break;case 8:a="<!--"+o(e.nodeValue)+"-->";break;default:a="<"+s+">",f="</>"}a&&t.push(a);for(var l=0;l<i;++l)u(r[l],t);return f&&t.push(f),t}function a(e){var t=u(e).join("");return i(t).toString(16)}function f(e,t,n){var r=[],i=e;n=n||s.getDocument(e).documentElement;while(i&&i!=n)r.push(s.getNodeIndex(i,!0)),i=i.parentNode;return r.join("/")+":"+t}function l(e,n,r){n||(n=(r||document).documentElement);var i=e.split(":"),o=n,u=i[0]?i[0].split("/"):[],a=u.length,f;while(a--){f=parseInt(u[a],10);if(!(f<o.childNodes.length))throw t.createError("deserializePosition() failed: node "+s.inspectNode(o)+" has no child with index "+f+", "+a);o=o.childNodes[f]}return new s.DomPosition(o,parseInt(i[1],10))}function c(n,r,i){i=i||e.DomRange.getRangeDocument(n).documentElement;if(!s.isOrIsAncestorOf(i,n.commonAncestorContainer))throw t.createError("serializeRange(): range "+n.inspect()+" is not wholly contained within specified root node "+s.inspectNode(i));var o=f(n.startContainer,n.startOffset,i)+","+f(n.endContainer,n.endOffset,i);return r||(o+="{"+a(i)+"}"),o}function p(n,r,i){r?i=i||s.getDocument(r):(i=i||document,r=i.documentElement);var o=h.exec(n),u=o[4];if(u){var f=a(r);if(u!==f)throw t.createError("deserializeRange(): checksums of serialized range root node ("+u+") and target root node ("+f+") do not match")}var c=l(o[1],r,i),p=l(o[2],r,i),d=e.createRange(i);return d.setStartAndEnd(c.node,c.offset,p.node,p.offset),d}function d(e,t,n){t||(t=(n||document).documentElement);var r=h.exec(e),i=r[3];return!i||i===a(t)}function v(t,n,r){t=e.getSelection(t);var i=t.getAllRanges(),s=[];for(var o=0,u=i.length;o<u;++o)s[o]=c(i[o],n,r);return s.join("|")}function m(t,n,r){n?r=r||s.getWindow(n):(r=r||window,n=r.document.documentElement);var i=t.split("|"),o=e.getSelection(r),u=[];for(var a=0,f=i.length;a<f;++a)u[a]=p(i[a],n,r.document);return o.setRanges(u),o}function g(e,t,n){var r;t?r=n?n.document:s.getDocument(t):(n=n||window,t=n.document.documentElement);var i=e.split("|");for(var o=0,u=i.length;o<u;++o)if(!d(i[o],t,r))return!1;return!0}function b(e){var t=e.split(/[;,]/);for(var n=0,r=t.length,i,s;n<r;++n){i=t[n].split("=");if(i[0].replace(/^\s+/,"")==y){s=i[1];if(s)return decodeURIComponent(s.replace(/\s+$/,""))}}return null}function w(e){e=e||window;var t=b(e.document.cookie);t&&m(t,e.doc)}function E(t,n){t=t||window,n=typeof n=="object"?n:{};var r=n.expires?";expires="+n.expires.toUTCString():"",i=n.path?";path="+n.path:"",s=n.domain?";domain="+n.domain:"",o=n.secure?";secure":"",u=v(e.getSelection(t));t.document.cookie=encodeURIComponent(y)+"="+encodeURIComponent(u)+r+i+s+o}var n="undefined",r=e.util;(typeof encodeURIComponent==n||typeof decodeURIComponent==n)&&t.fail("encodeURIComponent and/or decodeURIComponent method is missing");var i=function(){function e(e){var t=[];for(var n=0,r=e.length,i;n<r;++n)i=e.charCodeAt(n),i<128?t.push(i):i<2048?t.push(i>>6|192,i&63|128):t.push(i>>12|224,i>>6&63|128,i&63|128);return t}function n(){var e=[];for(var t=0,n,r;t<256;++t){r=t,n=8;while(n--)(r&1)==1?r=r>>>1^3988292384:r>>>=1;e[t]=r>>>0}return e}function r(){return t||(t=n()),t}var t=null;return function(t){var n=e(t),i=-1,s=r();for(var o=0,u=n.length,a;o<u;++o)a=(i^n[o])&255,i=i>>>8^s[a];return(i^-1)>>>0}}(),s=e.dom,h=/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/,y="rangySerializedSelection";r.extend(e,{serializePosition:f,deserializePosition:l,serializeRange:c,deserializeRange:p,canDeserializeRange:d,serializeSelection:v,deserializeSelection:m,canDeserializeSelection
:g,restoreSelectionFromCookie:w,saveSelectionCookie:E,getElementChecksum:a,nodeToInfoString:u}),r.crc32=i}),e},this),function(e,t){e(t.rangy)}(function(e){return e.createModule("ClassApplier",["WrappedSelection"],function(e,t){function l(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)return!1;return!0}function c(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function h(e,t){return!!e&&(new RegExp("(?:^|\\s)"+t+"(?:\\s|$)")).test(e)}function p(e,t){if(typeof e.classList=="object")return e.classList.contains(t);var n=typeof e.className=="string",r=n?e.className:e.getAttribute("class");return h(r,t)}function d(e,t){if(typeof e.classList=="object")e.classList.add(t);else{var n=typeof e.className=="string",r=n?e.className:e.getAttribute("class");r?h(r,t)||(r+=" "+t):r=t,n?e.className=r:e.setAttribute("class",r)}}function m(e){var t=typeof e.className=="string";return t?e.className:e.getAttribute("class")}function g(e){return e&&e.split(/\s+/).sort().join(" ")}function y(e){return g(m(e))}function b(e,t){return y(e)==y(t)}function w(e,t){var n=t.split(/\s+/);for(var r=0,i=n.length;r<i;++r)if(!p(e,c(n[r])))return!1;return!0}function E(e){var t=e.parentNode;return t&&t.nodeType==1&&!/^(textarea|style|script|select|iframe)$/i.test(t.nodeName)}function S(e,t,n,r,i){var s=e.node,o=e.offset,u=s,a=o;s==r&&o>i&&++a,s==t&&(o==n||o==n+1)&&(u=r,a+=i-n),s==t&&o>n+1&&--a,e.node=u,e.offset=a}function x(e,t,n){e.node==t&&e.offset>n&&--e.offset}function T(e,t,r,i){r==-1&&(r=t.childNodes.length);var s=e.parentNode,o=n.getNodeIndex(e);u(i,function(e){S(e,s,o,t,r)}),t.childNodes.length==r?t.appendChild(e):t.insertBefore(e,t.childNodes[r])}function N(e,t){var r=e.parentNode,i=n.getNodeIndex(e);u(t,function(e){x(e,r,i)}),n.removeNode(e)}function C(e,t,n,r,i){var s,o=[];while(s=e.firstChild)T(s,t,n++,i),o.push(s);return r&&N(e,i),o}function k(e,t){return C(e,e.parentNode,n.getNodeIndex(e),!0,t)}function L(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e),i=r?r.toString():"";return i!=""}function A(e){var t=e.getNodes([3]),n=0,r;while((r=t[n])&&!L(e,r))++n;var i=t.length-1;while((r=t[i])&&!L(e,r))--i;return t.slice(n,i+1)}function O(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n=0,r=e.attributes.length,i,s,o;n<r;++n){i=e.attributes[n],o=i.name;if(o!="class"){s=t.attributes.getNamedItem(o);if(i===null!=(s===null))return!1;if(i.specified!=s.specified)return!1;if(i.specified&&i.nodeValue!==s.nodeValue)return!1}}return!0}function M(e,t){for(var n=0,r=e.attributes.length,i;n<r;++n){i=e.attributes[n].name;if((!t||!s(t,i))&&e.attributes[n].specified&&i!="class")return!0}return!1}function P(e){var t;return e&&e.nodeType==1&&((t=e.parentNode)&&t.nodeType==9&&t.designMode=="on"||D(e)&&!D(e.parentNode))}function H(e){return(D(e)||e.nodeType!=1&&D(e.parentNode))&&!P(e)}function j(e){return e&&e.nodeType==1&&!B.test(_(e,"display"))}function I(e){if(e.data.length==0)return!0;if(F.test(e.data))return!1;var t=_(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return j(e.previousSibling)||j(e.nextSibling)}function q(e){var t=[],n,i;for(n=0;i=e[n++];)t.push(new r(i.startContainer,i.startOffset),new r(i.endContainer,i.endOffset));return t}function R(e,t){for(var n=0,r,i,s,o=e.length;n<o;++n)r=e[n],i=t[n*2],s=t[n*2+1],r.setStartAndEnd(i.node,i.offset,s.node,s.offset)}function U(e,t){return n.isCharacterDataNode(e)?t==0?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function z(e,r,i,s){var o,u,a=i==0;if(n.isAncestorOf(r,e))return e;if(n.isCharacterDataNode(r)){var f=n.getNodeIndex(r);if(i==0)i=f;else{if(i!=r.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+r.data);i=f+1}r=r.parentNode}if(U(r,i)){o=r.cloneNode(!1),u=r.parentNode,o.id&&o.removeAttribute("id");var l,c=0;while(l=r.childNodes[i])T(l,o,c++,s);return T(o,u,n.getNodeIndex(r)+1,s),r==e?o:z(e,u,n.getNodeIndex(o),s)}if(e!=r){o=r.parentNode;var h=n.getNodeIndex(r);return a||h++,z(e,o,h,s)}return e}function W(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&b(e,t)&&O(e,t)&&_(e,"display")=="inline"&&_(t,"display")=="inline"}function X(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var i=n.parentNode,s=n[t];if(s){if(s&&s.nodeType==3)return s}else if(r){s=i[t];if(s&&s.nodeType==1&&W(i,s)){var o=s[e?"firstChild":"lastChild"];if(o&&o.nodeType==3)return o}}return null}}function J(e){this.isElementMerge=e.nodeType==1,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function G(e,t,n){var r,i,s,o,u=this;u.cssClass=u.className=e;var a=null,f={};if(typeof t=="object"&&t!==null){typeof t.elementTagName!="undefined"&&(t.elementTagName=t.elementTagName.toLowerCase()),n=t.tagNames,a=t.elementProperties,f=t.elementAttributes;for(i=0;o=K[i++];)t.hasOwnProperty(o)&&(u[o]=t[o]);r=t.normalize}else r=t;u.normalize=typeof r=="undefined"?!0:r,u.attrExceptions=[];var h=document.createElement(u.elementTagName);u.elementProperties=u.copyPropertiesToElement(a,h,!0),l(f,function(e,t){u.attrExceptions.push(e),f[e]=""+t}),u.elementAttributes=f,u.elementSortedClassName=u.elementProperties.hasOwnProperty("className")?g(u.elementProperties.className+" "+e):e,u.applyToAnyTagName=!1;var p=typeof n;if(p=="string")n=="*"?u.applyToAnyTagName=!0:u.tagNames=c(n.toLowerCase()).split(/\s*,\s*/);else if(p=="object"&&typeof n.length=="number"){u.tagNames=[];for(i=0,s=n.length;i<s;++i)n[i]=="*"?u.applyToAnyTagName=!0:u.tagNames.push(n[i].toLowerCase())}else u.tagNames=[u.elementTagName]}function Y(e,t,n){return new G(e,t,n)}var n=e.dom,r=n.DomPosition,s=n.arrayContains,o=e.util,u=o.forEach,a="span",f=o.isHostMethod(document,"createElementNS"),v=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){if(typeof t.classList=="object")t.classList.remove(n);else{var r=typeof t.
className=="string",i=r?t.className:t.getAttribute("class");i=i.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e),r?t.className=i:t.setAttribute("class",i)}}}(),_=n.getComputedStyleProperty,D=function(){var e=document.createElement("div");return typeof e.isContentEditable=="boolean"?function(e){return e&&e.nodeType==1&&e.isContentEditable}:function(e){return!e||e.nodeType!=1||e.contentEditable=="false"?!1:e.contentEditable=="true"||D(e.parentNode)}}(),B=/^inline(-block|-table)?$/i,F=/[^\r\n\t\f \u200B]/,V=X(!1),$=X(!0);J.prototype={doMerge:function(e){var t=this.textNodes,r=t[0];if(t.length>1){var i=n.getNodeIndex(r),s=[],o=0,a,f;u(t,function(t,a){f=t.parentNode,a>0&&(f.removeChild(t),f.hasChildNodes()||n.removeNode(f),e&&u(e,function(e){e.node==t&&(e.node=r,e.offset+=o),e.node==f&&e.offset>i&&(--e.offset,e.offset==i+1&&a<len-1&&(e.node=r,e.offset=o))})),s[a]=t.data,o+=t.data.length}),r.data=s.join("")}return r.data},getLength:function(){var e=this.textNodes.length,t=0;while(e--)t+=this.textNodes[e].length;return t},toString:function(){var e=[];return u(this.textNodes,function(t,n){e[n]="'"+t.data+"'"}),"[Merge("+e.join(",")+")]"}};var K=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],Q={};G.prototype={elementTagName:a,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,i,s={},o,u,a,f;for(var l in e)if(e.hasOwnProperty(l)){u=e[l],a=t[l];if(l=="className")d(t,u),d(t,this.className),t[l]=g(t[l]),n&&(s[l]=u);else if(l=="style"){i=a,n&&(s[l]=o={});for(r in e[l])e[l].hasOwnProperty(r)&&(i[r]=u[r],n&&(o[r]=i[r]));this.attrExceptions.push(l)}else t[l]=u,n&&(s[l]=t[l],f=Q.hasOwnProperty(l)?Q[l]:l,this.attrExceptions.push(f))}return n?s:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return s(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],function(e){return t.appliesToElement(e)&&!e.hasChildNodes()})},hasClass:function(e){return e.nodeType==1&&(this.applyToAnyTagName||this.appliesToElement(e))&&p(e,this.className)},getSelfOrAncestorWithClass:function(e){while(e){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||H(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&e.nodeType==3&&I(e)},postApply:function(e,t,n,r){var s=e[0],o=e[e.length-1],a=[],f,l=s,c=o,h=0,p=o.length,d,v;u(e,function(e){v=V(e,!r),v?(f||(f=new J(v),a.push(f)),f.textNodes.push(e),e===s&&(l=f.textNodes[0],h=l.length),e===o&&(c=f.textNodes[0],p=f.getLength())):f=null});var m=$(o,!r);m&&(f||(f=new J(o),a.push(f)),f.textNodes.push(m));if(a.length){for(i=0,len=a.length;i<len;++i)a[i].doMerge(n);t.setStartAndEnd(l,h,c,p)}},createContainer:function(e){var t=n.getDocument(e),r,i=f&&!n.isHtmlNamespace(e)&&(r=e.namespaceURI)?t.createElementNS(e.namespaceURI,this.elementTagName):t.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,i,!1),this.copyAttributesToElement(this.elementAttributes,i),d(i,this.className),this.onElementCreate&&this.onElementCreate(i,this),i},elementHasProperties:function(e,t){var n=this;return l(t,function(t,r){if(t=="className")return w(e,r);if(typeof r=="object"){if(!n.elementHasProperties(e[t],r))return!1}else if(e[t]!==r)return!1})},elementHasAttributes:function(e,t){return l(t,function(t,n){if(e.getAttribute(t)!==n)return!1})},applyToTextNode:function(e,t){if(E(e)){var n=e.parentNode;if(n.childNodes.length==1&&this.useExistingElements&&this.appliesToElement(n)&&this.elementHasProperties(n,this.elementProperties)&&this.elementHasAttributes(n,this.elementAttributes))d(n,this.className);else{var r=e.parentNode,i=this.createContainer(r);r.insertBefore(i,e),i.appendChild(e)}}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&y(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!M(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return e.nodeType==1&&this.isRemovable(e)&&(t==0||t==1&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),r=[e],i=q(r);u(n,function(e){N(e,i)}),R(r,i)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var i=t.cloneRange();i.selectNode(n),i.isPointInRange(t.endContainer,t.endOffset)&&(z(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),i.isPointInRange(t.startContainer,t.startOffset)&&(n=z(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?k(n,r):v(n,this.className)},splitAncestorWithClass:function(e,t,n){var r=this.getSelfOrAncestorWithClass(e);r&&z(r,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?k(e,t):v(e,this.className)},applyToRange:function(e,t){var n=this;t=t||[];var r=q(t||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e);var i=A(e);if(i.length){u(i,function(e){!n.isIgnorableWhiteSpaceNode(e)&&!n.getSelfOrAncestorWithClass(e)&&n.isModifiable(e)&&n.applyToTextNode(e,r)});var s=i[i.length-1];e.setStartAndEnd(i[0],0,s,s.length),n.normalize&&n.postApply(i,e,r,!1),R(t,r)}var o=n.getEmptyElements(e);u(o,function(e){d(e,n.className)})},applyToRanges:function(e){var t=e.length;while(t--)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){var n=this;t=t||[];var r=q(t);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e,r);var i=A(e),s,o,a=i[i.length-1];if(i.length){n.splitAncestorWithClass(e.endContainer,e.endOffset,r),n.splitAncestorWithClass
(e.startContainer,e.startOffset,r);for(var f=0,l=i.length;f<l;++f)s=i[f],o=n.getSelfOrAncestorWithClass(s),o&&n.isModifiable(s)&&n.undoToAncestor(o,r);e.setStartAndEnd(i[0],0,a,a.length),n.normalize&&n.postApply(i,e,r,!0),R(t,r)}var c=n.getEmptyElements(e);u(c,function(e){v(e,n.className)})},undoToRanges:function(e){var t=e.length;while(t--)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),r=e.getSelection(t).getAllRanges();this.undoToRanges(r),n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||e.toString()=="")return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n=0,r;r=t[n++];)if(!this.isIgnorableWhiteSpaceNode(r)&&L(e,r)&&this.isModifiable(r)&&!this.getSelfOrAncestorWithClass(r))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(t==0)return!1;while(t--)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var r=n.getSelfOrAncestorWithClass(e);r&&!s(t,r)&&t.push(r)}),t},detach:function(){}},G.util={hasClass:p,addClass:d,removeClass:v,getClass:m,hasSameClasses:b,hasAllClasses:w,replaceWithOwnChildren:k,elementsHaveSameNonClassAttributes:O,elementHasNonClassAttributes:M,splitNodeAt:z,isEditableElement:D,isEditingHost:P,isEditable:H},e.CssClassApplier=e.ClassApplier=G,e.createClassApplier=Y,o.createAliasForDeprecatedMethod(e,"createCssClassApplier","createClassApplier",t)}),e},this),function(e,t){e(t.rangy)}(function(e){return e.createModule("Highlighter",["ClassApplier"],function(e,t){function a(e,t){return e.characterRange.start-t.characterRange.start}function f(e,t){return t?e.getElementById(t):i(e)}function c(e,t){this.type=e,this.converterCreator=t}function h(e,t){l[e]=new c(e,t)}function p(e){var t=l[e];if(t instanceof c)return t.create();throw new Error("Highlighter type '"+e+"' is not valid")}function d(e,t){this.start=e,this.end=t}function m(e,t,n,r,i,s){i?(this.id=i,u=Math.max(u,i+1)):this.id=u++,this.characterRange=t,this.doc=e,this.classApplier=n,this.converter=r,this.containerElementId=s||null,this.applied=!1}function g(e,t){t=t||"textContent",this.doc=e||document,this.classAppliers={},this.highlights=[],this.converter=p(t)}var n=e.dom,r=n.arrayContains,i=n.getBody,s=e.util.createOptions,o=e.util.forEach,u=1,l={};c.prototype.create=function(){var e=this.converterCreator();return e.type=this.type,e},e.registerHighlighterType=h,d.prototype={intersects:function(e){return this.start<e.end&&this.end>e.start},isContiguousWith:function(e){return this.start==e.end||this.end==e.start},union:function(e){return new d(Math.min(this.start,e.start),Math.max(this.end,e.end))},intersection:function(e){return new d(Math.max(this.start,e.start),Math.min(this.end,e.end))},getComplements:function(e){var t=[];if(this.start>=e.start){if(this.end<=e.end)return[];t.push(new d(e.end,this.end))}else t.push(new d(this.start,Math.min(this.end,e.start))),this.end>e.end&&t.push(new d(e.end,this.end));return t},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},d.fromCharacterRange=function(e){return new d(e.start,e.end)};var v={rangeToCharacterRange:function(e,t){var n=e.getBookmark(t);return new d(n.start,n.end)},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.moveToBookmark({start:n.start,end:n.end,containerNode:r}),i},serializeSelection:function(e,t){var n=e.getAllRanges(),r=n.length,i=[],s=r==1&&e.isBackward();for(var o=0,u=n.length;o<u;++o)i[o]={characterRange:this.rangeToCharacterRange(n[o],t),backward:s};return i},restoreSelection:function(e,t,n){e.removeAllRanges();var r=e.win.document;for(var i=0,s=t.length,o,u,a;i<s;++i)u=t[i],a=u.characterRange,o=this.characterRangeToRange(r,u.characterRange,n),e.addRange(o,u.backward)}};h("textContent",function(){return v}),h("TextRange",function(){var t;return function(){if(!t){var n=e.modules.TextRange;if(!n)throw new Error("TextRange module is missing.");if(!n.supported)throw new Error("TextRange module is present but not supported.");t={rangeToCharacterRange:function(e,t){return d.fromCharacterRange(e.toCharacterRange(t))},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.selectCharacters(r,n.start,n.end),i},serializeSelection:function(e,t){return e.saveCharacterRanges(t)},restoreSelection:function(e,t,n){e.restoreCharacterRanges(n,t)}}}return t}}()),m.prototype={getContainerElement:function(){return f(this.doc,this.containerElementId)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(e){this.characterRange=this.converter.rangeToCharacterRange(e,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(e){return this.getRange().containsNodeContents(e.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.className+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}},g.prototype={addClassApplier:function(e){this.classAppliers[e.className]=e},getHighlightForElement:function(e){var t=this.highlights;for(var n=0,r=t.length;n<r;++n)if(t[n].containsElement(e))return t[n];return null},removeHighlights:function(e){for(var t=0,n=this.highlights.length,i;t<n;++t)i=this.highlights[t],r(e,i)&&(i.unapply(),this
.highlights.splice(t--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(e){var t=[],n=this.highlights;return o(e,function(e){o(n,function(n){e.intersectsRange(n.getRange())&&!r(t,n)&&t.push(n)})}),t},highlightCharacterRanges:function(t,n,r){var i,u,a,f=this.highlights,l=this.converter,c=this.doc,h=[],p=t?this.classAppliers[t]:null;r=s(r,{containerElementId:null,exclusive:!0});var v=r.containerElementId,g=r.exclusive,y,b,w;v&&(y=this.doc.getElementById(v),y&&(b=e.createRange(this.doc),b.selectNodeContents(y),w=new d(0,b.toString().length)));var E,S,x,T,N,C;for(i=0,u=n.length;i<u;++i){E=n[i],N=[],w&&(E=E.intersection(w));if(E.start==E.end)continue;for(a=0;a<f.length;++a)x=!1,v==f[a].containerElementId&&(S=f[a].characterRange,T=p==f[a].classApplier,C=!T&&g,(S.intersects(E)||S.isContiguousWith(E))&&(T||C)&&(C&&o(S.getComplements(E),function(e){N.push(new m(c,e,f[a].classApplier,l,null,v))}),x=!0,T&&(E=S.union(E)))),x?(h.push(f[a]),f[a]=new m(c,S.union(E),p,l,null,v)):N.push(f[a]);p&&N.push(new m(c,E,p,l,null,v)),this.highlights=f=N}o(h,function(e){e.unapply()});var k=[];return o(f,function(e){e.applied||(e.apply(),k.push(e))}),k},highlightRanges:function(t,n,r){var u=[],a=this.converter;r=s(r,{containerElement:null,exclusive:!0});var f=r.containerElement,l=f?f.id:null,c;return f&&(c=e.createRange(f),c.selectNodeContents(f)),o(n,function(e){var t=f?c.intersection(e):e;u.push(a.rangeToCharacterRange(t,f||i(e.getDocument())))}),this.highlightCharacterRanges(t,u,{containerElementId:l,exclusive:r.exclusive})},highlightSelection:function(t,n){var r=this.converter,i=t?this.classAppliers[t]:!1;n=s(n,{containerElementId:null,selection:e.getSelection(this.doc),exclusive:!0});var u=n.containerElementId,a=n.exclusive,l=n.selection,c=l.win.document,h=f(c,u);if(!i&&t!==!1)throw new Error("No class applier found for class '"+t+"'");var p=r.serializeSelection(l,h),v=[];o(p,function(e){v.push(d.fromCharacterRange(e.characterRange))});var m=this.highlightCharacterRanges(t,v,{containerElementId:u,exclusive:a});return r.restoreSelection(l,p,h),m},unhighlightSelection:function(t){t=t||e.getSelection(this.doc);var n=this.getIntersectingHighlights(t.getAllRanges());return this.removeHighlights(n),t.removeAllRanges(),n},getHighlightsInSelection:function(t){return t=t||e.getSelection(this.doc),this.getIntersectingHighlights(t.getAllRanges())},selectionOverlapsHighlight:function(e){return this.getHighlightsInSelection(e).length>0},serialize:function(e){var t=this,n=t.highlights,r,i,u,f;return n.sort(a),e=s(e,{serializeHighlightText:!1,type:t.converter.type}),r=e.type,u=r!=t.converter.type,u&&(f=p(r)),i=["type:"+r],o(n,function(n){var r=n.characterRange,s;u&&(s=n.getContainerElement(),r=f.rangeToCharacterRange(t.converter.characterRangeToRange(t.doc,r,s),s));var o=[r.start,r.end,n.id,n.classApplier.className,n.containerElementId];e.serializeHighlightText&&o.push(n.getText()),i.push(o.join("$"))}),i.join("|")},deserialize:function(e){var t=e.split("|"),n=[],r=t[0],i,s,o,u=!1;if(!r||!(i=/^type:(\w+)$/.exec(r)))throw new Error("Serialized highlights are invalid.");s=i[1],s!=this.converter.type&&(o=p(s),u=!0),t.shift();var a,l,c,h,v;for(var g=t.length,y;g-->0;){y=t[g].split("$"),c=new d(+y[0],+y[1]),h=y[4]||null,u&&(v=f(this.doc,h),c=this.converter.rangeToCharacterRange(o.characterRangeToRange(this.doc,c,v),v)),a=this.classAppliers[y[3]];if(!a)throw new Error("No class applier found for class '"+y[3]+"'");l=new m(this.doc,c,a,this.converter,parseInt(y[2]),h),l.apply(),n.push(l)}this.highlights=n}},e.Highlighter=g,e.createHighlighter=function(e,t){return new g(e,t)}}),e},this),function(e,t){e(t.rangy)}(function(e){return e.createModule("TextRange",["WrappedSelection"],function(e,t){function E(e,t){function s(e,t,n){i.push({start:e,end:t,isWord:n})}var n=e.join(""),r,i=[],o=0,u,a;while(r=t.wordRegex.exec(n)){u=r.index,a=u+r[0].length,u>o&&s(o,u,!1);if(t.includeTrailingSpace)while(p.test(e[a]))++a;s(u,a,!0),o=a}return o<e.length&&s(o,e.length,!1),i}function S(e,t){var n=e.slice(t.start,t.end),r={isWord:t.isWord,chars:n,toString:function(){return n.join("")}};for(var i=0,s=n.length;i<s;++i)n[i].token=r;return r}function x(e,t,n){var r=n(e,t),i=[];for(var s=0,o;o=r[s++];)i.push(S(e,o));return i}function N(e){var t=e||"",n=typeof t=="string"?t.split(""):t;return n.sort(function(e,t){return e.charCodeAt(0)-t.charCodeAt(0)}),n.join("").replace(/(.)\1+/g,"$1")}function _(e){var t,n;return e?(t=e.language||v,n={},u(n,k[t]||k[v]),u(n,e),n):k[v]}function D(e,t){var n=a(e,t);return t.hasOwnProperty("wordOptions")&&(n.wordOptions=_(n.wordOptions)),t.hasOwnProperty("characterOptions")&&(n.characterOptions=a(n.characterOptions,T)),n}function j(e,t){var n=P(e,"display",t),r=e.tagName.toLowerCase();return n=="block"&&H&&B.hasOwnProperty(r)?B[r]:n}function F(e){var t=W(e);for(var n=0,r=t.length;n<r;++n)if(t[n].nodeType==1&&j(t[n])=="none")return!0;return!1}function I(e){var t;return e.nodeType==3&&(t=e.parentNode)&&P(t,"visibility")=="hidden"}function q(e){return e&&(e.nodeType==1&&!/^(inline(-block|-table)?|none)$/.test(j(e))||e.nodeType==9||e.nodeType==11)}function R(e){var t=e.lastChild;return t?R(t):e}function U(e){return s.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function z(e){var t=[];while(e.parentNode)t.unshift(e.parentNode),e=e.parentNode;return t}function W(e){return z(e).concat([e])}function X(e){while(e&&!e.nextSibling)e=e.parentNode;return e?e.nextSibling:null}function V(e,t){return!t&&e.hasChildNodes()?e.firstChild:X(e)}function $(e){var t=e.previousSibling;if(t){e=t;while(e.hasChildNodes())e=e.lastChild;return e}var n=e.parentNode;return n&&n.nodeType==1?n:null}function J(e){if(!e||e.nodeType!=3)return!1;var t=e.data;if(t==="")return!0;var n=e.parentNode;if(!n||n.nodeType!=1)return!1;var r=P(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(r)||/^[\t\r ]+$/.test
(t)&&r=="pre-line"}function K(e){if(e.data==="")return!0;if(!J(e))return!1;var t=e.parentNode;return t?F(e)?!0:!1:!0}function Q(e){var t=e.nodeType;return t==7||t==8||F(e)||/^(script|style)$/i.test(e.nodeName)||I(e)||K(e)}function G(e,t){var n=e.nodeType;return n==7||n==8||n==1&&j(e,t)=="none"}function Y(){this.store={}}function tt(e,t,n){return function(r){var i=this.cache;if(i.hasOwnProperty(e))return Z++,i[e];et++;var s=t.call(this,n?this[n]:this,r);return i[e]=s,s}}function nt(e,t){this.node=e,this.session=t,this.cache=new Y,this.positions=new Y}function dt(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new Y}function vt(){return"[Position("+s.inspectNode(this.node)+":"+this.offset+")]"}function bt(){return Et(),gt=new yt}function wt(){return gt||bt()}function Et(){gt&&gt.detach(),gt=null}function St(e,n,r,i){function u(){var e=null;return n?(e=s,o||(s=s.previousVisible(),o=!s||r&&s.equals(r))):o||(e=s=s.nextVisible(),o=!s||r&&s.equals(r)),o&&(s=null),e}r&&(n?Q(r.node)&&(r=e.previousVisible()):Q(r.node)&&(r=r.nextVisible()));var s=e,o=!1,a,f=!1;return{next:function(){if(f)return f=!1,a;var e,t;while(e=u()){t=e.getCharacter(i);if(t)return a=e,e}return null},rewind:function(){if(!a)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");f=!0},dispose:function(){e=r=null}}}function Tt(e,t,n){function o(e){var t,n,s=[],o=e?r:i,u=!1,a=!1;while(t=o.next()){n=t.character;if(h.test(n))a&&(a=!1,u=!0);else{if(u){o.rewind();break}a=!0}s.push(t)}return s}function p(e){var t=["["+e.length+"]"];for(var n=0;n<e.length;++n)t.push("(word: "+e[n]+", is word: "+e[n].isWord+")");return t}var r=St(e,!1,null,t),i=St(e,!0,null,t),s=n.tokenizer,u=o(!0),a=o(!1).reverse(),f=x(a.concat(u),n,s),l=u.length?f.slice(xt(f,u[0].token)):[],c=a.length?f.slice(0,xt(f,a.pop().token)+1):[];return{nextEndToken:function(){var e,t;while(l.length==1&&!(e=l[0]).isWord&&(t=o(!0)).length>0)l=x(e.chars.concat(t),n,s);return l.shift()},previousStartToken:function(){var e,t;while(c.length==1&&!(e=c[0]).isWord&&(t=o(!1)).length>0)c=x(t.reverse().concat(e.chars),n,s);return c.pop()},dispose:function(){r.dispose(),i.dispose(),l=c=null}}}function Nt(e,t,n,s,o){var u=0,a,f=e,l,c,h=Math.abs(n),p;if(n!==0){var d=n<0;switch(t){case r:l=St(e,d,null,s);while((a=l.next())&&u<h)++u,f=a;c=a,l.dispose();break;case i:var v=Tt(e,s,o),m=d?v.previousStartToken:v.nextEndToken;while((p=m())&&u<h)p.isWord&&(++u,f=d?p.chars[0]:p.chars[p.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}d?(f=f.previousVisible(),u=-u):f&&f.isLeadingSpace&&!f.isTrailingSpace&&(t==i&&(l=St(e,!1,null,s),c=l.next(),l.dispose()),c&&(f=c.previousVisible()))}return{position:f,unitsMoved:u}}function Ct(e,t,n,r){var i=e.getRangeBoundaryPosition(t,!0),s=e.getRangeBoundaryPosition(t,!1),o=r?s:i,u=r?i:s;return St(o,!!r,u,n)}function kt(e,t,n){var r=[],i=Ct(e,t,n),s;while(s=i.next())r.push(s);return i.dispose(),r}function Lt(t,n,r){var i=e.createRange(t.node);return i.setStartAndEnd(t.node,t.offset,n.node,n.offset),!i.expand("word",{wordOptions:r})}function At(e,t,n,r,i){function g(e,t){var n=a[e].previousVisible(),r=a[t-1],s=!i.wholeWordsOnly||Lt(n,r,i.wordOptions);return{startPos:n,endPos:r,valid:s}}var s=m(i.direction),o=St(e,s,e.session.getRangeBoundaryPosition(r,s),i.characterOptions),u="",a=[],f,l,c,h,p,d,v=null;while(f=o.next()){l=f.character,!n&&!i.caseSensitive&&(l=l.toLowerCase()),s?(a.unshift(f),u=l+u):(a.push(f),u+=l);if(n){p=t.exec(u);if(p){c=p.index,h=c+p[0].length;if(d){if(!s&&h<u.length||s&&c>0){v=g(c,h);break}}else d=!0}}else if((c=u.indexOf(t))!=-1){v=g(c,c+t.length);break}}return d&&(v=g(c,h)),o.dispose(),v}function Ot(e){return function(){var t=!!gt,n=wt(),r=[n].concat(o.toArray(arguments)),i=e.apply(this,r);return t||Et(),i}}function Mt(e,t){return Ot(function(i,s,o,u){typeof o==n&&(o=s,s=r),u=D(u,A);var a=e;t&&(a=o>=0,this.collapse(!a));var f=Nt(i.getRangeBoundaryPosition(this,a),s,o,u.characterOptions,u.wordOptions),l=f.position;return this[a?"setStart":"setEnd"](l.node,l.offset),f.unitsMoved})}function _t(e){return Ot(function(t,n){n=a(n,T);var r,i=Ct(t,this,n,!e),s=0;while((r=i.next())&&h.test(r.character))++s;i.dispose();var o=s>0;return o&&this[e?"moveStart":"moveEnd"]("character",e?s:-s,{characterOptions:n}),o})}function Dt(e){return Ot(function(t,n){var r=!1;return this.changeEachRange(function(t){r=t[e](n)||r}),r})}var n="undefined",r="character",i="word",s=e.dom,o=e.util,u=o.extend,a=o.createOptions,f=s.getBody,l=/^[ \t\f\r\n]+$/,c=/^[ \t\f\r]+$/,h=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,p=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,d=/^[\n-\r\u0085\u2028\u2029]$/,v="en",m=e.Selection.isDirectionBackward,g=!1,y=!1,b=!1,w=!0;(function(){var t=s.createTestElement(document,"<p>1 </p><p></p>",!0),n=t.firstChild,r=e.getSelection();r.collapse(n.lastChild,2),r.setStart(n.firstChild,0),g=(""+r).length==1,t.innerHTML="1 <br />",r.collapse(t,2),r.setStart(t.firstChild,0),y=(""+r).length==1,t.innerHTML="1 <p>1</p>",r.collapse(t,2),r.setStart(t.firstChild,0),b=(""+r).length==1,s.removeNode(t),r.removeAllRanges()})();var T={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},C={includeBlockContentTrailingSpace:!w,includeSpaceBeforeBr:!y,includeSpaceBeforeBlock:!b,includePreLineTrailingSpace:!0},k={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:E}},L={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},A={wordOptions:null,characterOptions:null},O={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},M={wordOptions:null,characterOptions:null,direction:"forward"},P=s.getComputedStyleProperty,H;(function(){var e=document.createElement("table"),t=f(document);t.appendChild(e),H=P(e,"display")=="block"
,t.removeChild(e)})();var B={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};Y.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var Z=0,et=0,rt={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new dt(this,e))},toString:function(){return"[NodeWrapper("+s.inspectNode(this.node)+")]"}};nt.prototype=rt;var it="EMPTY",st="NON_SPACE",ot="UNCOLLAPSIBLE_SPACE",ut="COLLAPSIBLE_SPACE",at="TRAILING_SPACE_BEFORE_BLOCK",ft="TRAILING_SPACE_IN_BLOCK",lt="TRAILING_SPACE_BEFORE_BR",ct="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",ht="TRAILING_LINE_BREAK_AFTER_BR",pt="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";u(rt,{isCharacterDataNode:tt("isCharacterDataNode",s.isCharacterDataNode,"node"),getNodeIndex:tt("nodeIndex",s.getNodeIndex,"node"),getLength:tt("nodeLength",s.getNodeLength,"node"),containsPositions:tt("containsPositions",U,"node"),isWhitespace:tt("isWhitespace",J,"node"),isCollapsedWhitespace:tt("isCollapsedWhitespace",K,"node"),getComputedDisplay:tt("computedDisplay",j,"node"),isCollapsed:tt("collapsed",Q,"node"),isIgnored:tt("ignored",G,"node"),next:tt("nextPos",V,"node"),previous:tt("previous",$,"node"),getTextNodeInfo:tt("textNodeInfo",function(e){var t=null,n=!1,r=P(e.parentNode,"whiteSpace"),i=r=="pre-line";if(i)t=c,n=!0;else if(r=="normal"||r=="nowrap")t=l,n=!0;return{node:e,text:e.data,spaceRegex:t,collapseSpaces:n,preLine:i}},"node"),hasInnerText:tt("hasInnerText",function(e,t){var n=this.session,r=n.getPosition(e.parentNode,this.getNodeIndex()+1),i=n.getPosition(e,0),s=t?r:i,o=t?i:r;while(s!==o){s.prepopulateChar();if(s.isDefinitelyNonEmpty())return!0;s=t?s.previousVisible():s.nextVisible()}return!1},"node"),isRenderedBlock:tt("isRenderedBlock",function(e){var t=e.getElementsByTagName("br");for(var n=0,r=t.length;n<r;++n)if(!Q(t[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:tt("trailingSpace",function(e){if(e.tagName.toLowerCase()=="br")return"";switch(this.getComputedDisplay()){case"inline":var t=e.lastChild;while(t){if(!G(t))return t.nodeType==1?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:tt("leadingSpace",function(e){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var mt={character:"",characterType:it,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,n=e.offset,r="",i=it,s=!1;if(n>0)if(t.nodeType==3){var o=t.data,u=o.charAt(n-1),a=e.nodeWrapper.getTextNodeInfo(),f=a.spaceRegex;a.collapseSpaces?f.test(u)?n>1&&f.test(o.charAt(n-2))||(a.preLine&&o.charAt(n)==="\n"?(r=" ",i=ct):(r=" ",i=ut)):(r=u,i=st,s=!0):(r=u,i=ot,s=!0)}else{var l=t.childNodes[n-1];l&&l.nodeType==1&&!Q(l)&&(l.tagName.toLowerCase()=="br"?(r="\n",e.isBr=!0,i=ut,s=!1):e.checkForTrailingSpace=!0);if(!r){var c=t.childNodes[n];c&&c.nodeType==1&&!Q(c)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=r,e.characterType=i,e.isCharInvariant=s}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==st||e==ot},resolveLeadingAndTrailingSpaces:function(){this.prepopulatedChar||this.prepopulateChar();if(this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=ut),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=ut),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){var t=this,n;while(t=t.previousVisible()){n=t.getCharacter(e);if(n!=="")return t}return null},getCharacter:function(e){function p(){return c||(l=h.getPrecedingUncollapsedPosition(e),c=!0),l}this.resolveLeadingAndTrailingSpaces();var t=this.character,n,r=N(e.ignoreCharacters),i=t!==""&&r.indexOf(t)>-1;if(this.isCharInvariant)return n=i?"":t,n;var s=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace,r].join("_"),o=this.cache.get(s);if(o!==null)return o;var u="",a=this.characterType==ut,f,l,c=!1,h=this;if(a)if(this.type==pt)u="\n";else if(t!=" "||!(!p()||l.isTrailingSpace||l.character=="\n"||l.character==" "&&l.characterType==ut))if(t=="\n"&&this.isLeadingSpace)p()&&l.character!="\n"&&(u="\n");else{f=this.nextUncollapsed();if(f){f.isBr?this.type=lt:f.isTrailingSpace&&f.character=="\n"?this.type=ft:f.isLeadingSpace&&f.character=="\n"&&(this.type=at);if(f.character=="\n"){if(this.type!=lt||!!e.includeSpaceBeforeBr)if(this.type!=at||!!e.includeSpaceBeforeBlock)if(this.type!=ft||!f.isTrailingSpace||!!e.includeBlockContentTrailingSpace)if(this.type!=ct||f.type!=st||!!e.includePreLineTrailingSpace)t=="\n"?f.isTrailingSpace?this.isTrailingSpace||this.isBr&&(f.type=ht,p()&&l.isLeadingSpace&&!l.isTrailingSpace&&l.character=="\n"?f.character="":f.type=pt):u="\n":t==" "&&(u=" ")}else u=t}}return r.indexOf(u)>-1&&(u=""),this.cache.set(s,u),u},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:vt,toString:function(){return this.character}};dt.prototype=mt,u(mt,{next:tt("nextPos",function(e){var t=e.nodeWrapper,n=e.node,r=e.offset,i=t.session;if(!n)return null;var s,o,u;return r==t.getLength()?(s=n.parentNode,o=s?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(s=n,o=r+1):(u=n.childNodes[r],i.getNodeWrapper(u).containsPositions()?(s=u,o=0):(s=n,o=r+1)),s?i.getPosition
(s,o):null}),previous:tt("previous",function(e){var t=e.nodeWrapper,n=e.node,r=e.offset,i=t.session,o,u,a;return r==0?(o=n.parentNode,u=o?t.getNodeIndex():0):t.isCharacterDataNode()?(o=n,u=r-1):(a=n.childNodes[r-1],i.getNodeWrapper(a).containsPositions()?(o=a,u=s.getNodeLength(a)):(o=n,u=r-1)),o?i.getPosition(o,u):null}),nextVisible:tt("nextVisible",function(e){var t=e.next();if(!t)return null;var n=t.nodeWrapper,r=t.node,i=t;return n.isCollapsed()&&(i=n.session.getPosition(r.parentNode,n.getNodeIndex()+1)),i}),nextUncollapsed:tt("nextUncollapsed",function(e){var t=e;while(t=t.nextVisible()){t.resolveLeadingAndTrailingSpaces();if(t.character!=="")return t}return null}),previousVisible:tt("previousVisible",function(e){var t=e.previous();if(!t)return null;var n=t.nodeWrapper,r=t.node,i=t;return n.isCollapsed()&&(i=n.session.getPosition(r.parentNode,n.getNodeIndex())),i})});var gt=null,yt=function(){function e(e){var t=new Y;return{get:function(n){var r=t.get(n[e]);if(r)for(var i=0,s;s=r[i++];)if(s.node===n)return s;return null},set:function(n){var r=n.node[e],i=t.get(r)||t.set(r,[]);i.push(n)}}}function n(){this.initCaches()}var t=o.isHostProperty(document.documentElement,"uniqueID");return n.prototype={initCaches:function(){this.elementCache=t?function(){var e=new Y;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var n=t.get(e);return n||(n=new nt(e,this),t.set(n)),n},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var n=t?"start":"end";return this.getPosition(e[n+"Container"],e[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},n}();u(s,{nextNode:V,previousNode:$});var xt=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)if(e[n]===t)return n;return-1};u(e.rangePrototype,{moveStart:Mt(!0,!1),moveEnd:Mt(!1,!1),move:Mt(!0,!0),trimStart:_t(!0),trimEnd:_t(!1),trim:Ot(function(e,t){var n=this.trimStart(t),r=this.trimEnd(t);return n||r}),expand:Ot(function(e,t,n){var s=!1;n=D(n,O);var o=n.characterOptions;t||(t=r);if(t==i){var u=n.wordOptions,a=e.getRangeBoundaryPosition(this,!0),f=e.getRangeBoundaryPosition(this,!1),l=Tt(a,o,u),c=l.nextEndToken(),h=c.chars[0].previousVisible(),p,d;if(this.collapsed)p=c;else{var v=Tt(f,o,u);p=v.previousStartToken()}return d=p.chars[p.chars.length-1],h.equals(a)||(this.setStart(h.node,h.offset),s=!0),d&&!d.equals(f)&&(this.setEnd(d.node,d.offset),s=!0),n.trim&&(n.trimStart&&(s=this.trimStart(o)||s),n.trimEnd&&(s=this.trimEnd(o)||s)),s}return this.moveEnd(r,1,n)}),text:Ot(function(e,t){return this.collapsed?"":kt(e,this,a(t,T)).join("")}),selectCharacters:Ot(function(e,t,n,r,i){var s={characterOptions:i};t||(t=f(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",n,s),this.collapse(!0),this.moveEnd("character",r-n,s)}),toCharacterRange:Ot(function(e,t,n){t||(t=f(this.getDocument()));var r=t.parentNode,i=s.getNodeIndex(t),o=s.comparePoints(this.startContainer,this.endContainer,r,i)==-1,u=this.cloneRange(),a,l;return o?(u.setStartAndEnd(this.startContainer,this.startOffset,r,i),a=-u.text(n).length):(u.setStartAndEnd(r,i,this.startContainer,this.startOffset),a=u.text(n).length),l=a+this.text(n).length,{start:a,end:l}}),findText:Ot(function(t,n,r){r=D(r,L),r.wholeWordsOnly&&(r.wordOptions.includeTrailingSpace=!1);var i=m(r.direction),s=r.withinRange;s||(s=e.createRange(),s.selectNodeContents(this.getDocument()));var o=n,u=!1;typeof o=="string"?r.caseSensitive||(o=o.toLowerCase()):u=!0;var a=t.getRangeBoundaryPosition(this,!i),f=s.comparePoint(a.node,a.offset);f===-1?a=t.getRangeBoundaryPosition(s,!0):f===1&&(a=t.getRangeBoundaryPosition(s,!1));var l=a,c=!1,h;for(;;){h=At(l,o,u,s,r);if(h){if(h.valid)return this.setStartAndEnd(h.startPos.node,h.startPos.offset,h.endPos.node,h.endPos.offset),!0;l=i?h.startPos:h.endPos}else{if(!r.wrap||!!c)return!1;s=s.cloneRange(),l=t.getRangeBoundaryPosition(s,!i),s.setBoundary(a.node,a.offset,i),c=!0}}}),pasteHtml:function(e){this.deleteContents();if(e){var t=this.createContextualFragment(e),n=t.lastChild;this.insertNode(t),this.collapseAfter(n)}}}),u(e.selectionPrototype,{expand:Ot(function(e,t,n){this.changeEachRange(function(e){e.expand(t,n)})}),move:Ot(function(e,t,n,r){var i=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var s=this.getRangeAt(0);r||(r={}),r.characterOptions=a(r.characterOptions,C),i=s.move(t,n,r),this.setSingleRange(s)}return i}),trimStart:Dt("trimStart"),trimEnd:Dt("trimEnd"),trim:Dt("trim"),selectCharacters:Ot(function(t,n,r,i,s,o){var u=e.createRange(n);u.selectCharacters(n,r,i,o),this.setSingleRange(u,s)}),saveCharacterRanges:Ot(function(e,t,n){var r=this.getAllRanges(),i=r.length,s=[],o=i==1&&this.isBackward();for(var u=0,a=r.length;u<a;++u)s[u]={characterRange:r[u].toCharacterRange(t,n),backward:o,characterOptions:n};return s}),restoreCharacterRanges:Ot(function(t,n,r){this.removeAllRanges();for(var i=0,s=r.length,o,u,a;i<s;++i)u=r[i],a=u.characterRange,o=e.createRange(n),o.selectCharacters(n,a.start,a.end,u.characterOptions),this.addRange(o,u.backward)}),text:Ot(function(e,t){var n=[];for(var r=0,i=this.rangeCount;r<i;++r)n[r]=this.getRangeAt(r).text(t);return n.join("")})}),e.innerText=function(t,n){var r=e.createRange(t);r.selectNodeContents(t);var i=r.text(n);return i},e.createWordIterator=function(e,t,n){var r=wt();n=D(n,M);var i=r.getPosition(e,t),s=Tt(i,n.characterOptions,n.wordOptions),o=m(n.direction);return{next:function(){return o?s.previousStartToken():s.nextEndToken()},dispose:function(){s.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=wt();e(t),Et()},e.noMutation.createEntryPointFunction=
Ot,e.textRange={isBlockNode:q,isCollapsedWhitespaceNode:K,createPosition:Ot(function(e,t,n){return e.getPosition(t,n)})}}),e},this),YUI.add("moodle-editor_atto-rangy",function(e,t){rangy.initialized||rangy.init()},"@VERSION@",{requires:[]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("handlebars-base",function(e,t){
/*!
Handlebars.js - Copyright (C) 2011 Yehuda Katz
https://raw.github.com/wycats/handlebars.js/master/LICENSE
*/
;var n=e.namespace("Handlebars");n.VERSION="1.0.0",n.COMPILER_REVISION=4,n.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},n.helpers={},n.partials={};var r=Object.prototype.toString,i="[object Function]",s="[object Object]";n.registerHelper=function(e,t,i){if(r.call(e)===s){if(i||t)throw new n.Exception("Arg not supported with multiple helpers");n.Utils.extend(this.helpers,e)}else i&&(t.not=i),this.helpers[e]=t},n.registerPartial=function(e,t){r.call(e)===s?n.Utils.extend(this.partials,e):this.partials[e]=t},n.registerHelper("helperMissing",function(e){if(arguments.length===2)return undefined;throw new Error("Missing helper: '"+e+"'")}),n.registerHelper("blockHelperMissing",function(e,t){var s=t.inverse||function(){},o=t.fn,u=r.call(e);return u===i&&(e=e.call(this)),e===!0?o(this):e===!1||e==null?s(this):u==="[object Array]"?e.length>0?n.helpers.each(e,t):s(this):o(e)}),n.K=function(){},n.createFrame=Object.create||function(e){n.K.prototype=e;var t=new n.K;return n.K.prototype=null,t},n.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(e,t){if(n.logger.level<=e){var r=n.logger.methodMap[e];typeof console!="undefined"&&console[r]&&console[r].call(console,t)}}},n.log=function(e,t){n.logger.log(e,t)},n.registerHelper("each",function(e,t){var s=t.fn,o=t.inverse,u=0,a="",f,l=r.call(e);l===i&&(e=e.call(this)),t.data&&(f=n.createFrame(t.data));if(e&&typeof e=="object")if(e instanceof Array)for(var c=e.length;u<c;u++)f&&(f.index=u),a+=s(e[u],{data:f});else for(var h in e)e.hasOwnProperty(h)&&(f&&(f.key=h),a+=s(e[h],{data:f}),u++);return u===0&&(a=o(this)),a}),n.registerHelper("if",function(e,t){var s=r.call(e);return s===i&&(e=e.call(this)),!e||n.Utils.isEmpty(e)?t.inverse(this):t.fn(this)}),n.registerHelper("unless",function(e,t){return n.helpers["if"].call(this,e,{fn:t.inverse,inverse:t.fn})}),n.registerHelper("with",function(e,t){var s=r.call(e);s===i&&(e=e.call(this));if(!n.Utils.isEmpty(e))return t.fn(e)}),n.registerHelper("log",function(e,t){var r=t.data&&t.data.level!=null?parseInt(t.data.level,10):1;n.log(r,e)});var o=["description","fileName","lineNumber","message","name","number","stack"];n.Exception=function(e){var t=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<o.length;n++)this[o[n]]=t[o[n]]},n.Exception.prototype=new Error,n.SafeString=function(e){this.string=e},n.SafeString.prototype.toString=function(){return this.string.toString()};var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},a=/[&<>"'`]/g,f=/[&<>"'`]/,l=function(e){return u[e]||"&amp;"};n.Utils={extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},escapeExpression:function(e){return e instanceof n.SafeString?e.toString():e==null||e===!1?"":(e=e.toString(),f.test(e)?e.replace(a,l):e)},isEmpty:function(e){return!e&&e!==0?!0:r.call(e)==="[object Array]"&&e.length===0?!0:!1}},n.VM={template:function(e){var t={escapeExpression:n.Utils.escapeExpression,invokePartial:n.VM.invokePartial,programs:[],program:function(e,t,r){var i=this.programs[e];return r?i=n.VM.program(e,t,r):i||(i=this.programs[e]=n.VM.program(e,t)),i},merge:function(e,t){var r=e||t;return e&&t&&(r={},n.Utils.extend(r,t),n.Utils.extend(r,e)),r},programWithDepth:n.VM.programWithDepth,noop:n.VM.noop,compilerInfo:null};return function(r,i){i=i||{};var s=e.call(t,n,r,i.helpers,i.partials,i.data),o=t.compilerInfo||[],u=o[0]||1,a=n.COMPILER_REVISION;if(u!==a){if(u<a){var f=n.REVISION_CHANGES[a],l=n.REVISION_CHANGES[u];throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+f+") or downgrade your runtime to an older version ("+l+")."}throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+o[1]+")."}return s}},programWithDepth:function(e,t,n){var r=Array.prototype.slice.call(arguments,3),i=function(e,i){return i=i||{},t.apply(this,[e,i.data||n].concat(r))};return i.program=e,i.depth=r.length,i},program:function(e,t,n){var r=function(e,r){return r=r||{},t(e,r.data||n)};return r.program=e,r.depth=0,r},noop:function(){return""},invokePartial:function(e,t,r,i,s,o){var u={helpers:i,partials:s,data:o};if(e===undefined)throw new n.Exception("The partial "+t+" could not be found");if(e instanceof Function)return e(r,u);if(!n.compile)throw new n.Exception("The partial "+t+" could not be compiled when running in runtime-only mode");return s[t]=n.compile(e,{data:o!==undefined}),s[t](r,u)}},n.template=n.VM.template,n.VERSION+="-yui",n.revive=n.template,e.namespace("Template").Handlebars=n},"3.17.2",{requires:[]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("handlebars-compiler",function(e,t){
/*!
Handlebars.js - Copyright (C) 2011 Yehuda Katz
https://raw.github.com/wycats/handlebars.js/master/LICENSE
*/
;var n=e.Handlebars,r=function(){function n(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,params:27,hash:28,dataName:29,param:30,STRING:31,INTEGER:32,BOOLEAN:33,hashSegments:34,hashSegment:35,ID:36,EQUALS:37,DATA:38,pathSegments:39,SEP:40,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",31:"STRING",32:"INTEGER",33:"BOOLEAN",36:"ID",37:"EQUALS",38:"DATA",40:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],performAction:function(t,n,r,i,s,o,u){var a=o.length-1;switch(s){case 1:return o[a-1];case 2:this.$=new i.ProgramNode([],o[a]);break;case 3:this.$=new i.ProgramNode(o[a-2],o[a]);break;case 4:this.$=new i.ProgramNode(o[a-1],[]);break;case 5:this.$=new i.ProgramNode(o[a]);break;case 6:this.$=new i.ProgramNode([],[]);break;case 7:this.$=new i.ProgramNode([]);break;case 8:this.$=[o[a]];break;case 9:o[a-1].push(o[a]),this.$=o[a-1];break;case 10:this.$=new i.BlockNode(o[a-2],o[a-1].inverse,o[a-1],o[a]);break;case 11:this.$=new i.BlockNode(o[a-2],o[a-1],o[a-1].inverse,o[a]);break;case 12:this.$=o[a];break;case 13:this.$=o[a];break;case 14:this.$=new i.ContentNode(o[a]);break;case 15:this.$=new i.CommentNode(o[a]);break;case 16:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 17:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 18:this.$=o[a-1];break;case 19:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1],o[a-2][2]==="&");break;case 20:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1],!0);break;case 21:this.$=new i.PartialNode(o[a-1]);break;case 22:this.$=new i.PartialNode(o[a-2],o[a-1]);break;case 23:break;case 24:this.$=[[o[a-2]].concat(o[a-1]),o[a]];break;case 25:this.$=[[o[a-1]].concat(o[a]),null];break;case 26:this.$=[[o[a-1]],o[a]];break;case 27:this.$=[[o[a]],null];break;case 28:this.$=[[o[a]],null];break;case 29:o[a-1].push(o[a]),this.$=o[a-1];break;case 30:this.$=[o[a]];break;case 31:this.$=o[a];break;case 32:this.$=new i.StringNode(o[a]);break;case 33:this.$=new i.IntegerNode(o[a]);break;case 34:this.$=new i.BooleanNode(o[a]);break;case 35:this.$=o[a];break;case 36:this.$=new i.HashNode(o[a]);break;case 37:o[a-1].push(o[a]),this.$=o[a-1];break;case 38:this.$=[o[a]];break;case 39:this.$=[o[a-2],o[a]];break;case 40:this.$=[o[a-2],new i.StringNode(o[a])];break;case 41:this.$=[o[a-2],new i.IntegerNode(o[a])];break;case 42:this.$=[o[a-2],new i.BooleanNode(o[a])];break;case 43:this.$=[o[a-2],o[a]];break;case 44:this.$=new i.PartialNameNode(o[a]);break;case 45:this.$=new i.PartialNameNode(new i.StringNode(o[a]));break;case 46:this.$=new i.PartialNameNode(new i.IntegerNode(o[a]));break;case 47:this.$=new i.DataNode(o[a]);break;case 48:this.$=new i.IdNode(o[a]);break;case 49:o[a-2].push({part:o[a],separator:o[a-1]}),this.$=o[a-2];break;case 50:this.$=[{part:o[a]}]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16
:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],defaultActions:{17:[2,1]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(
){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:return n.yytext="\\",14;case 1:n.yytext.slice(-1)!=="\\"&&this.begin("mu"),n.yytext.slice(-1)==="\\"&&(n.yytext=n.yytext.substr(0,n.yyleng-1),this.begin("emu"));if(n.yytext)return 14;break;case 2:return 14;case 3:return n.yytext.slice(-1)!=="\\"&&this.popState(),n.yytext.slice(-1)==="\\"&&(n.yytext=n.yytext.substr(0,n.yyleng-1)),14;case 4:return n.yytext=n.yytext.substr(0,n.yyleng-4),this.popState(),15;case 5:return 25;case 6:return 16;case 7:return 20;case 8:return 19;case 9:return 19;case 10:return 23;case 11:return 22;case 12:this.popState(),this.begin("com");break;case 13:return n.yytext=n.yytext.substr(3,n.yyleng-5),this.popState(),15;case 14:return 22;case 15:return 37;case 16:return 36;case 17:return 36;case 18:return 40;case 19:break;case 20:return this.popState(),24;case 21:return this.popState(),18;case 22:return n.yytext=n.yytext.substr(1,n.yyleng-2).replace(/\\"/g,'"'),31;case 23:return n.yytext=n.yytext.substr(1,n.yyleng-2).replace(/\\'/g,"'"),31;case 24:return 38;case 25:return 33;case 26:return 33;case 27:return 32;case 28:return 36;case 29:return n.yytext=n.yytext.substr(1,n.yyleng-2),36;case 30:return"INVALID";case 31:return 5}},e.rules=[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!1},emu:{rules:[3],inclusive:!1},com:{rules:[4],inclusive:!1},INITIAL:{rules:[0,1,2,31],inclusive:!0}},e}();return e.lexer=t,n.prototype=e,e.Parser=n,new n}();n.Parser=r,n.parse=function(e){return e.constructor===n.AST.ProgramNode?e:(n.Parser.yy=n.AST,n.Parser.parse(e))},n.AST={},n.AST.ProgramNode=function(e,t){this.type="program",this.statements=e,t&&(this.inverse=new n.AST.ProgramNode(t))},n.AST.MustacheNode=function(e,t,n){this.type="mustache",this.escaped=!n,this.hash=t;var r=this.id=e[0],i=this.params=e.slice(1),s=this.eligibleHelper=r.isSimple;this.isHelper=s&&(i.length||t)},n.AST.PartialNode=function(e,t){this.type="partial",this.partialName=e,this.context=t},n.AST.BlockNode=function(e,t,r,i){var s=function(e,t){if(e.original!==t.original)throw new n.Exception(e.original+" doesn't match "+t.original)};s(e.id,i),this.type="block",this.mustache=e,this.program=t,this.inverse=r,this.inverse&&!this.program&&(this.isInverse=!0)},n.AST.ContentNode=function(e){this.type="content",this.string=e},n.AST.HashNode=function(e){this.type="hash",this.pairs=e},n.AST.IdNode=function(e){this.type="ID";var t="",r=[],i=0;for(var s=0,o=e.length;s<o;s++){var u=e[s].part;t+=(e[s].separator||"")+u;if(u===".."||u==="."||u==="this"){if(r.length>0)throw new n.Exception("Invalid path: "+t);u===".."?i++:this.isScoped=!0}else r.push(u)}this.original=t,this.parts=r,this.string=r.join("."),this.depth=i,this.isSimple=e.length===1&&!this.isScoped&&i===0,this.stringModeValue=this.string},n.AST.PartialNameNode=function(e){this.type="PARTIAL_NAME",this.name=e.original},n.AST.DataNode=function(e){this.type="DATA",this.id=e},n.AST.StringNode=function(e){this.type="STRING",this.original=this.string=this.stringModeValue=e},n.AST.IntegerNode=function(e){this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)},n.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e,this.stringModeValue=e==="true"},n.AST.CommentNode=function(e){this.type="comment",this.comment=e};var i=n.Compiler=function(){},s=n.JavaScriptCompiler=function(){};i.prototype={compiler:i,disassemble:function(){var e=this.opcodes,t,n=[],r,i;for(var s=0,o=e.length;s<o;s++){t=e[s];if(t.opcode==="DECLARE")n.push("DECLARE "+t.name+"="+t.value);else{
r=[];for(var u=0;u<t.args.length;u++)i=t.args[u],typeof i=="string"&&(i='"'+i.replace("\n","\\n")+'"'),r.push(i);n.push(t.opcode+" "+r.join(" "))}}return n.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var r=this.opcodes[n],i=e.opcodes[n];if(r.opcode!==i.opcode||r.args.length!==i.args.length)return!1;for(var s=0;s<r.args.length;s++)if(r.args[s]!==i.args[s])return!1}t=this.children.length;if(e.children.length!==t)return!1;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t=e.statements,n;this.opcodes=[];for(var r=0,i=t.length;r<i;r++)n=t[r],this[n.type](n);return this.isSimple=i===1,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++,r;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var i=0,s=t.depths.list.length;i<s;i++){r=t.depths.list[i];if(r<2)continue;this.addDepth(r-1)}return n},block:function(e){var t=e.mustache,n=e.program,r=e.inverse;n&&(n=this.compileProgram(n)),r&&(r=this.compileProgram(r));var i=this.classifyMustache(t);i==="helper"?this.helperMustache(t,n,r):i==="simple"?(this.simpleMustache(t),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(t,n,r),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("pushHash");for(var i=0,s=t.length;i<s;i++)n=t[i],r=n[1],this.options.stringParams?(r.depth&&this.addDepth(r.depth),this.opcode("getContext",r.depth||0),this.opcode("pushStringParam",r.stringModeValue,r.type)):this.accept(r),this.opcode("assignToHash",n[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,n=this.classifyMustache(e);n==="simple"?this.simpleMustache(e):n==="helper"?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,n){var r=e.id,i=r.parts[0],s=t!=null||n!=null;this.opcode("getContext",r.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",i,s)},simpleMustache:function(e){var t=e.id;t.type==="DATA"?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,n){var r=this.setupFullMustacheParams(e,t,n),i=e.id.parts[0];if(this.options.knownHelpers[i])this.opcode("invokeKnownHelper",r.length,i);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+i);this.opcode("invokeHelper",r.length,i)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var n=1,r=e.parts.length;n<r;n++)this.opcode("lookup",e.parts[n])},DATA:function(e){this.options.data=!0;if(e.id.isScoped||e.id.depth)throw new n.Exception("Scoped data references are not supported: "+e.original);this.opcode("lookupData");var t=e.id.parts;for(var r=0,i=t.length;r<i;r++)this.opcode("lookup",t[r])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw new Error("EWOT");if(e===0)return;this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e))},classifyMustache:function(e){var t=e.isHelper,n=e.eligibleHelper,r=this.options;if(n&&!t){var i=e.id.parts[0];r.knownHelpers[i]?t=!0:r.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){var t=e.length,n;while(t--)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type)):this[n.type](n)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("emptyHash"),t},setupFullMustacheParams:function(e,t,n){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),r}};var o=function(e){this.value=e};s.prototype={nameLookup:function(e,t){return/^[0-9]+$/.test(t)?e+"["+t+"]":s.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,r,i){this.environment=e,this.options=t||{},n.log(n.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!r,this.context=r||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var s=e.opcodes,o;this.i=0;for(l=s.length;this.i<l;this.i++)o=s[this
.i],o.opcode==="DECLARE"?this[o.name]=o.value:this[o.opcode].apply(this,o.args);return this.createFunctionContext(i)},nextOpcode:function(){var e=this.environment.opcodes;return e[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var e=[];if(!this.isChild){var t=this.namespace,n="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(n=n+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(n+=" data = data || {};"),e.push(n)}else e.push("");this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", "));if(!this.isChild)for(var r in this.context.aliases)this.context.aliases.hasOwnProperty(r)&&(this.source[1]=this.source[1]+", "+r+"="+this.context.aliases[r]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var s=0,o=this.environment.depths.list.length;s<o;s++)i.push("depth"+this.environment.depths.list[s]);var u=this.mergeSource();if(!this.isChild){var a=n.COMPILER_REVISION,f=n.REVISION_CHANGES[a];u="this.compilerInfo = ["+a+",'"+f+"'];\n"+u}if(e)return i.push(u),Function.apply(this,i);var l="function "+(this.name||"")+"("+i.join(",")+") {\n  "+u+"}";return n.log(n.logger.DEBUG,l+"\n\n"),l},mergeSource:function(){var e="",t;for(var n=0,r=this.source.length;n<r;n++){var i=this.source[n];i.appendToBuffer?t?t=t+"\n    + "+i.content:t=i.content:(t&&(e+="buffer += "+t+";\n  ",t=undefined),e+=i+"\n  ")}return e},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),e[e.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){this.flushInline();var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(e){this.push("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),typeof e=="string"?this.pushString(e):this.pushStackLiteral(e)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=undefined,this.options.stringParams&&(this.register("hashContexts","{"+e.contexts.join(",")+"}"),this.register("hashTypes","{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){e!=null?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var n=this.lastHelper=this.setupHelper(e,t,!0),r=this.nameLookup("depth"+this.lastContext,t,"context");this.push(n.name+" || "+r),this.replaceStack(function(e){return e+" ? "+e+".call("+n.callParams+") "+": helperMissing.call("+n.helperMissingParams+")"})},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var n=this.setupHelper(0,e,t),r=this.lastHelper=this.nameLookup("helpers",e,"helper"),i=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();this.source.push("if ("+s+" = "+r+") { "+s+" = "+s+".call("+n.callParams+"); }"),this.source.push("else { "+s+" = "+i+"; "+s+" = typeof "+s+" === functionType ? "+s+".apply(depth0) : "+s+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t=this.popStack(),n,r;this.options.stringParams&&(r=this.popStack(),n=this.popStack());var i=this.hash;n&&i.contexts.push("'"+e+"': "+n),r&&i.types.push("'"+e+"': "+r),i.values.push("'"+e+"': ("+t+")")},compiler:s,compileChildren:function(e,t){var n=e.children,r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=new this.compiler;var u=this.matchExistingProgram(r);u==null?(this.context.programs.push(""),u=this.context.programs.length,r.index=u,r.name="program"+u,this.context.programs[u]=i.compile
(r,t,this.context),this.context.environments[u]=r):(r.index=u,r.name="program"+u)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var r=this.context.environments[t];if(r&&r.equals(e))return t}},programExpression:function(e){this.context.aliases.self="this";if(e==null)return"self.noop";var t=this.environment.children[e],n=t.depths.list,r,i=[t.index,t.name,"data"];for(var s=0,o=n.length;s<o;s++)r=n[s],r===1?i.push("depth0"):i.push("depth"+(r-1));return(n.length===0?"self.program(":"self.programWithDepth(")+i.join(", ")+")"},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new o(e))},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.source.push(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t="",n=this.isInline(),r;if(n){var i=this.popStack(!0);if(i instanceof o)r=i.value;else{var s=this.stackSlot?this.topStackName():this.incrStack();t="("+this.push(s)+" = "+i+"),",r=this.topStack()}}else r=this.topStack();var u=e.call(this,r);return n?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+t+u+")")):(/^stack/.test(r)||(r=this.nextStack()),this.source.push(r+" = ("+t+u+");")),r},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];r instanceof o?this.compileStack.push(r):this.pushStack(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();return!e&&n instanceof o?n.value:(t||this.stackSlot--,n)},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,n=t[t.length-1];return!e&&n instanceof o?n.value:n},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,n){var r=[];this.setupParams(e,r,n);var i=this.nameLookup("helpers",t,"helper");return{params:r,name:i,callParams:["depth0"].concat(r).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(r).join(", ")}},setupParams:function(e,t,n){var r=[],i=[],s=[],o,u,a;r.push("hash:"+this.popStack()),u=this.popStack(),a=this.popStack();if(a||u)a||(this.context.aliases.self="this",a="self.noop"),u||(this.context.aliases.self="this",u="self.noop"),r.push("inverse:"+u),r.push("fn:"+a);for(var f=0;f<e;f++)o=this.popStack(),t.push(o),this.options.stringParams&&(s.push(this.popStack()),i.push(this.popStack()));return this.options.stringParams&&(r.push("contexts:["+i.join(",")+"]"),r.push("types:["+s.join(",")+"]"),r.push("hashContexts:hashContexts"),r.push("hashTypes:hashTypes")),this.options.data&&r.push("data:data"),r="{"+r.join(",")+"}",n?(this.register("options",r),t.push("options")):t.push(r),t.join(", ")}};var u="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),a=s.RESERVED_WORDS={};for(var f=0,l=u.length;f<l;f++)a[u[f]]=!0;s.isValidJavaScriptVariableName=function(e){return!s.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1},n.precompile=function(e,t){if(e==null||typeof e!="string"&&e.constructor!==n.AST.ProgramNode)throw new n.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var r=n.parse(e),o=(new i).compile(r,t);return(new s).compile(o,t)},n.compile=function(e,t){function o(){var r=n.parse(e),o=(new i).compile(r,t),u=(new s).compile(o,t,undefined,!0);return n.template(u)}if(e==null||typeof e!="string"&&e.constructor!==n.AST.ProgramNode)throw new n.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var r;return function(e,t){return r||(r=o()),r.call(this,e,t)}};var c=["debug","info","warn","error"];n.logger.log=function(e,t){},n.render=function(e,t,r){return n.compile(e)(t,r)}},"3.17.2",{requires:["handlebars-base"]});
YUI.add("moodle-core-handlebars",function(e,t){e.Handlebars.registerHelper("get_string",function(){var t=new e.Array(arguments);return t.pop(),t.push(arguments[arguments.length-1].hash),M.util.get_string.apply(this,t)}),e.Handlebars.registerHelper("image_url",function(){var t=new e.Array(arguments);return t.pop(),M.util.image_url.apply(this,t)})},"@VERSION@");
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("timers",function(e,t){function i(e){return s}function s(e){this.capacity=this.snap(e),this.length=0,this.front=0,this.initialize()}function o(e,t,n,r,i){for(var s=0;s<i;++s)n[s+r]=e[s+t]}function u(e){return e>>>=0,e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1}function v(){while(a.length>0){var e=a.shift();try{e.call()}catch(t){if(d)throw l(),t;setTimeout(function(){throw t},0)}}f=!1}function y(e){d&&p.domain&&(e=p.domain.bind(e)),a.push(e),f||(l(),f=!0)}function b(e){var t;return b._asynchronizer(function(){t||e()}),{cancel:function(){t=1}}}var n={},r=e.config.global;"use strict",n.exports=s,s.prototype.push=function(e){var t=this.length;this.capacity<=t&&this.grow(this.snap(this.capacity*this.growFactor));var n=this.front+t&this.capacity-1;this[n]=e,this.length=t+1},s.prototype.shift=function(){var e=this.front,t=this[e];return this[e]=void 0,this.front=e+1&this.capacity-1,this.length--,t},s.prototype.grow=function(e){var t=this.front,n=this.capacity,r=new Array(n),i=this.length;o(this,0,r,0,n),this.capacity=e,this.initialize(),this.front=0;if(t+i<=n)o(r,t,this,0,i);else{var s=i-(t+i&n-1);o(r,t,this,0,s),o(r,0,this,s,i-s)}},s.prototype.initialize=function(){var e=this.capacity;for(var t=0;t<e;++t)this[t]=void 0},s.prototype.snap=function(e){return typeof e!="number"?this.minCapacity:u(Math.min(this.maxCapacity,Math.max(this.minCapacity,e)))},s.prototype.maxCapacity=1<<30|0,s.prototype.minCapacity=16,s.prototype.growFactor=8,"use strict";var s=i("./queue"),a=new s(1024),f=!1,l=void 0,c=typeof setImmediate=="function",h,p=r.process,d=!!p&&{}.toString.call(p)==="[object process]";if(d)l=function(){var e=p.domain;e&&(h=h||(1,i)("domain"),h.active=p.domain=null),f&&c?setImmediate(v):p.nextTick(v),e&&(h.active=p.domain=e)};else if(c)l=function(){setImmediate(v)};else if(typeof MessageChannel!="undefined"){var m=new MessageChannel;m.port1.onmessage=function(){l=g,m.port1.onmessage=v,v()};var g=function(){m.port2.postMessage(0)};l=function(){setTimeout(v,0),g()}}else l=function(){setTimeout(v,0)};n.exports=y,b._asynchronizer=y,b._impl="asap",e.soon=b},"3.17.2",{requires:["yui-base"]});
/*
YUI 3.17.2 (build 9c3c78e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("querystring-stringify",function(e,t){var n=e.namespace("QueryString"),r=[],i=e.Lang;n.escape=encodeURIComponent,n.stringify=function(e,t,s){var o,u,a,f,l,c,h=t&&t.sep?t.sep:"&",p=t&&t.eq?t.eq:"=",d=t&&t.arrayKey?t.arrayKey:!1;if(i.isNull(e)||i.isUndefined(e)||i.isFunction(e))return s?n.escape(s)+p:"";if(i.isBoolean(e)||Object.prototype.toString.call(e)==="[object Boolean]")e=+e;if(i.isNumber(e)||i.isString(e))return n.escape(s)+p+n.escape(e);if(i.isArray(e)){c=[],s=d?s+"[]":s,f=e.length;for(a=0;a<f;a++)c.push(n.stringify(e[a],t,s));return c.join(h)}for(a=r.length-1;a>=0;--a)if(r[a]===e)throw new Error("QueryString.stringify. Cyclical reference");r.push(e),c=[],o=s?s+"[":"",u=s?"]":"";for(a in e)e.hasOwnProperty(a)&&(l=o+a+u,c.push(n.stringify(e[a],t,l)));return r.pop(),c=c.join(h),!c&&s?s+"=":c}},"3.17.2",{requires:["yui-base"]});
YUI.add("moodle-editor_atto-editor",function(e,t){function s(){s.superclass.constructor.apply(this,arguments)}function f(){}function l(){}function d(){}function m(){m.superclass.constructor.apply(this,arguments),this._submitEvents={},this._queue=[],this._throttle=null}function g(){}function y(){}function b(){}function w(){}function E(){}function S(){}function x(){}function T(){}var n="moodle-editor_atto-editor",r={CONTENT:"editor_atto_content",CONTENTWRAPPER:"editor_atto_content_wrap",TOOLBAR:"editor_atto_toolbar",WRAPPER:"editor_atto",HIGHLIGHT:"highlight"},i=window.rangy;e.extend(s,e.Base,{BLOCK_TAGS:["address","article","aside","audio","blockquote","canvas","dd","div","dl","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","noscript","ol","output","p","pre","section","table","tfoot","ul","video"],PLACEHOLDER_CLASS:"atto-tmp-class",ALL_NODES_SELECTOR:"[style],font[face]",FONT_FAMILY:"fontFamily",_wrapper:null,editor:null,textarea:null,textareaLabel:null,plugins:null,_eventHandles:null,initializer:function(){var t;this.textarea=e.one(document.getElementById(this.get("elementid")));if(!this.textarea)return;var n=this.textarea.getAttribute("class");this._eventHandles=[],this._wrapper=e.Node.create('<div class="'+r.WRAPPER+'" />'),t=e.Handlebars.compile('<div id="{{elementid}}editable" contenteditable="true" role="textbox" spellcheck="true" aria-live="off" class="{{CSS.CONTENT}} '+n+'" '+"/>"),this.editor=e.Node.create(t({elementid:this.get("elementid"),CSS:r})),this.textareaLabel=e.one('[for="'+this.get("elementid")+'"]'),this.textareaLabel&&(this.textareaLabel.generateID(),this.editor.setAttribute("aria-labelledby",this.textareaLabel.get("id"))),this.setupToolbar();var i=e.Node.create('<div class="'+r.CONTENTWRAPPER+'" />');i.appendChild(this.editor),this._wrapper.appendChild(i),this.editor.setStyle("minHeight",20*this.textarea.getAttribute("rows")+8+"px"),e.UA.ie===0&&this.editor.setStyle("height",20*this.textarea.getAttribute("rows")+8+"px"),this.disableCssStyling(),document.queryCommandSupported("DefaultParagraphSeparator")&&document.execCommand("DefaultParagraphSeparator",!1,"p"),this.textarea.get("parentNode").insert(this._wrapper,this.textarea).setAttribute("class","editor_atto_wrap"),this.textarea.hide(),e.mix(e.Node.DOM_EVENTS,{"form:editorUpdated":!0}),this.textarea.on("form:editorUpdated",function(){this.updateEditorState()},this),this.updateFromTextArea(),this.publishEvents(),this.setupSelectionWatchers(),this.setupAutomaticPolling(),this.setupPlugins(),this.setupAutosave(),this.setupNotifications()},focus:function(){return this.editor.focus(),this},publishEvents:function(){return this.publish("change",{broadcast:!0,preventable:!0}),this.publish("pluginsloaded",{fireOnce:!0}),this.publish("atto:selectionchanged",{prefix:"atto"}),this},setupAutomaticPolling:function(){return this._registerEventHandle(this.editor.on(["keyup","cut"],this.updateOriginal,this)),this._registerEventHandle(this.editor.on("paste",this.pasteCleanup,this)),this._registerEventHandle(this.editor.on("drop",this.updateOriginalDelayed,this)),this},updateOriginalDelayed:function(){return e.soon(e.bind(this.updateOriginal,this)),this},setupPlugins:function(){this.plugins={};var t=this.get("plugins"),n,r,i,s,o;for(n in t){r=t[n];if(!r.plugins)continue;for(i in r.plugins){s=r.plugins[i],o=e.mix({name:s.name,group:r.group,editor:this.editor,toolbar:this.toolbar,host:this},s);if(typeof e.M["atto_"+s.name]=="undefined")continue;this.plugins[s.name]=new e.M["atto_"+s.name].Button(o)}}return this.fire("pluginsloaded"),this},enablePlugins:function(e){this._setPluginState(!0,e)},disablePlugins:function(e){this._setPluginState(!1,e)},_setPluginState:function(t,n){var r="disableButtons";t&&(r="enableButtons"),n?this.plugins[n][r]():e.Object.each(this.plugins,function(e){e[r]()},this)},updateEditorState:function(){var t=this.textarea.hasAttribute("readonly"),n=e.one("#"+this.get("elementid")+"editable");this._setPluginState(!t),n&&n.setAttribute("contenteditable",!t)},_registerEventHandle:function(e){this._eventHandles.push(e)}},{NS:"editor_atto",ATTRS:{elementid:{value:null,writeOnce:!0},contextid:{value:null,writeOnce:!0},plugins:{value:{},writeOnce:!0}}}),e.augment(s,e.EventTarget),e.namespace("M.editor_atto").Editor=s,e.namespace("M.editor_atto.Editor").init=function(t){return new e.M.editor_atto.Editor(t)};var o="moodle-editor_atto-editor-notify",u="info",a="warning";f.ATTRS={},f.prototype={messageOverlay:null,hideTimer:null,setupNotifications:function(){var e=new Image,t=new Image;return e.src=M.util.image_url("i/warning","moodle"),t.src=M.util.image_url("i/info","moodle"),this},showMessage:function(t,n,r){var i="",s,o;return this.messageOverlay===null&&(this.messageOverlay=e.Node.create('<div class="editor_atto_notification"></div>'),this.messageOverlay.hide(!0),this.textarea.get("parentNode").append(this.messageOverlay),this.messageOverlay.on("click",function(){this.messageOverlay.hide(!0)},this)),this.hideTimer!==null&&this.hideTimer.cancel(),n===a?i='<img src="'+M.util.image_url("i/warning","moodle")+'" alt="'+M.util.get_string("warning","moodle")+'"/>':n===u&&(i='<img src="'+M.util.image_url("i/info","moodle")+'" alt="'+M.util.get_string("info","moodle")+'"/>'),s=parseInt(r,10),s<=0&&(s=6e4),n="atto_"+n,o=e.Node.create('<div class="'+n+'" role="alert" aria-live="assertive">'+i+" "+e.Escape.html(t)+"</div>"),this.messageOverlay.empty(),this.messageOverlay.append(o),this.messageOverlay.show(!0),this.hideTimer=e.later(s,this,function(){this.hideTimer=null,this.messageOverlay.inDoc()&&this.messageOverlay.hide(!0)}),this}},e.Base.mix(e.M.editor_atto.Editor,[f]),l.ATTRS={},l.prototype={_getEmptyContent:function(){return e.UA.ie&&e.UA.ie<10?"<p></p>":"<p><br></p>"},updateFromTextArea:function(){return this.editor.setHTML(""),this.editor.append(this._cleanHTML(this.textarea.get("value"))),this.editor.getHTML()===""&&this.editor.setHTML(this._getEmptyContent()),this},updateOriginal
:function(){var e=this.textarea.get("value"),t=this.getCleanHTML();return t===""&&this.isActive()&&(t=this._getEmptyContent()),e!==t&&(this.textarea.set("value",t),this.textarea.simulate("change"),this.fire("change")),this}},e.Base.mix(e.M.editor_atto.Editor,[l]);var c=5e3,h=6e4,p="moodle-editor_atto-editor-autosave";d.ATTRS={autosaveEnabled:{value:!0,writeOnce:!0},autosaveFrequency:{value:60,writeOnce:!0},pageHash:{value:"",writeOnce:!0}},d.prototype={lastText:"",autosaveInstance:null,autosaveTimer:null,setupAutosave:function(){var t=-1,n,r=null,i=this.get("filepickeroptions"),s;if(!this.get("autosaveEnabled"))return;this.autosaveInstance=e.stamp(this);for(r in i)typeof i[r].itemid!="undefined"&&(t=i[r].itemid);s={contextid:this.get("contextid"),action:"resume",draftid:t,elementid:this.get("elementid"),pageinstance:this.autosaveInstance,pagehash:this.get("pageHash")},this.autosaveIo(s,this,{success:function(e){if(e===null)return;if(!e)return;if(e.result==="<p></p>"||e.result==="<p><br></p>"||e.result==="<br>")e.result="";if(e.result==="<p>&nbsp;</p>"||e.result==="<p><br>&nbsp;</p>")e.result="";e.error||typeof e.result=="undefined"?this.showMessage(M.util.get_string("errortextrecovery","editor_atto"),a,h):e.result!==this.textarea.get("value")&&e.result!==""&&this.recoverText(e.result),this._fireSelectionChanged()},failure:function(){this.showMessage(M.util.get_string("errortextrecovery","editor_atto"),a,h)}});var o=parseInt(this.get("autosaveFrequency"),10)*1e3;return this.autosaveTimer=e.later(o,this,this.saveDraft,!1,!0),n=this.textarea.ancestor("form"),n&&this.autosaveIoOnSubmit(n,{action:"reset",contextid:this.get("contextid"),elementid:this.get("elementid"),pageinstance:this.autosaveInstance,pagehash:this.get("pageHash")}),this},recoverText:function(e){return this.editor.setHTML(e),this.saveSelection(),this.updateOriginal(),this.lastText=e,this.showMessage(M.util.get_string("textrecovered","editor_atto"),u,h),require(["core/event"],function(e){e.notifyEditorContentRestored()}),this},saveDraft:function(){var t,n;if(!this.editor.getDOMNode()){this.autosaveTimer.cancel();return}this.editor.get("hidden")||this.updateOriginal();var r=this.textarea.get("value");if(r!==this.lastText){t=M.cfg.wwwroot+this.get("autosaveAjaxScript"),n={sesskey:M.cfg.sesskey,contextid:this.get("contextid"),action:"save",drafttext:r,elementid:this.get("elementid"),pagehash:this.get("pageHash"),pageinstance:this.autosaveInstance};var i=function(e){var t=parseInt(this.get("autosaveFrequency"),10)*1e3;this.showMessage(M.util.get_string("autosavefailed","editor_atto"),a,t)};this.autosaveIo(n,this,{failure:i,success:function(t){t&&t.error?e.soon(e.bind(i,this,[t])):(this.lastText=r,this.showMessage(M.util.get_string("autosavesucceeded","editor_atto"),u,c))}})}return this}},e.Base.mix(e.M.editor_atto.Editor,[d]);var v=null;m.NAME="EditorAutosaveIoDispatcher",m.ATTRS={autosaveAjaxScript:{value:"/lib/editor/atto/autosave-ajax.php",readOnly:!0},delay:{value:50,readOnly:!0}},e.extend(m,e.Base,{dispatch:function(t,n,r){this._throttle&&this._throttle.cancel(),this._throttle=e.later(this.get("delay"),this,this._processDispatchQueue),this._queue.push([t,n,r])},_processDispatchQueue:function(){var t=this._queue,n={};this._queue=[];if(t.length<1)return;e.Array.each(t,function(e,t){n[t]=e[0]}),e.io(M.cfg.wwwroot+this.get("autosaveAjaxScript"),{method:"POST",data:e.QueryString.stringify({actions:n,sesskey:M.cfg.sesskey}),on:{start:this._makeIoEventCallback("start",t),complete:this._makeIoEventCallback("complete",t),failure:this._makeIoEventCallback("failure",t),end:this._makeIoEventCallback("end",t),success:this._makeIoEventCallback("success",t)}})},_makeIoEventCallback:function(t,n){var r=function(){};return function(){var i=arguments[1],s={};(t=="complete"||t=="success")&&typeof i!="undefined"&&typeof i.responseText!="undefined"&&i.responseText!==""&&(s=JSON.parse(i.responseText)||{}),e.Array.each(n,function(e,n){var i=e[1],o=e[2]&&e[2][t]||r,u;s&&s.error?u=s:s&&(u=s[n]),o.apply(i,[u])})}},_onSubmit:function(t){var n={},r=t.currentTarget.generateID(),i=this._submitEvents[r];if(!i||i.ios.length<1)return;e.Array.each(i.ios,function(e,t){n[t]=e}),e.io(M.cfg.wwwroot+this.get("autosaveAjaxScript"),{method:"POST",data:e.QueryString.stringify({actions:n,sesskey:M.cfg.sesskey}),sync:!0})},whenSubmit:function(e,t){typeof this._submitEvents[e.generateID()]=="undefined"&&(this._submitEvents[e.generateID()]={event:e.on("submit",this._onSubmit,this),ajaxEvent:e.on(M.core.event.FORM_SUBMIT_AJAX,this._onSubmit,this),ios:[]}),this._submitEvents[e.get("id")].ios.push([t])}}),v=new m,g.prototype={autosaveIo:function(e,t,n){v.dispatch(e,t,n)},autosaveIoOnSubmit:function(e,t){v.whenSubmit(e,t)}},e.Base.mix(e.M.editor_atto.Editor,[g]),y.ATTRS={},y.prototype={getCleanHTML:function(){var t=this.editor.cloneNode(!0),n;return e.each(t.all('[id^="yui"]'),function(e){e.removeAttribute("id")}),t.all(".atto_control").remove(!0),n=t.get("innerHTML"),n==="<p></p>"||n==="<p><br></p>"?"":this._cleanHTML(n)},cleanEditorHTML:function(){var e=this.editor.get("innerHTML");return this.editor.set("innerHTML",this._cleanHTML(e)),this},_cleanHTML:function(e){var t=[{regex:/<style[^>]*>[\s\S]*?<\/style>/gi,replace:""},{regex:/<!--(?![\s\S]*?-->)/gi,replace:""},{regex:/<\/?(?:title|meta|style|st\d|head\b|font|html|body|link)[^>]*?>/gi,replace:""}];return this._filterContentWithRules(e,t)},_filterContentWithRules:function(e,t){var n=0;for(n=0;n<t.length;n++)e=e.replace(t[n].regex,t[n].replace);return e},pasteCleanup:function(e){if(e.type==="paste"){var t=e._event;if(!(t&&t.clipboardData&&t.clipboardData.getData&&t.clipboardData.types))return this.fallbackPasteCleanupDelayed(),!0;var n=t.clipboardData.types,r=!1;typeof n.contains=="function"?r=n.contains("text/html"):typeof n.indexOf=="function"&&(r=n.indexOf("text/html")>-1);var i;if(r){try{i=t.clipboardData.getData("text/html")}catch(s){return this.fallbackPasteCleanupDelayed(),!0}e.preventDefault(),i=this._cleanPasteHTML
(i);var o=window.rangy.saveSelection();return this.insertContentAtFocusPoint(i),window.rangy.restoreSelection(o),window.rangy.getSelection().collapseToEnd(),this.updateOriginal(),!1}try{i=t.clipboardData.getData("text")}catch(s){return this.fallbackPasteCleanupDelayed(),!0}}return this.updateOriginalDelayed(),!0},fallbackPasteCleanup:function(){var e=window.rangy.saveSelection(),t=this.editor.get("innerHTML");return this.editor.set("innerHTML",this._cleanPasteHTML(t)),this.updateOriginal(),window.rangy.restoreSelection(e),this},fallbackPasteCleanupDelayed:function(){return e.soon(e.bind(this.fallbackPasteCleanup,this)),this},_cleanPasteHTML:function(e){if(!e||e.length===0)return"";var t=[{regex:/<\s*\/html\s*>([\s\S]+)$/gi,replace:""},{regex:/<!--\[if[\s\S]*?endif\]-->/gi,replace:""},{regex:/<!--(Start|End)Fragment-->/gi,replace:""},{regex:/<xml[^>]*>[\s\S]*?<\/xml>/gi,replace:""},{regex:/<\?xml[^>]*>[\s\S]*?<\\\?xml>/gi,replace:""},{regex:/<\/?\w+:[^>]*>/gi,replace:""}];e=this._filterContentWithRules(e,t),e=this._cleanHTML(e);if(e.length===0||!e.match(/\S/))return e;var n=document.createElement("div");return n.innerHTML=e,e=n.innerHTML,n.innerHTML="",t=[{regex:/(<[^>]*?class\s*?=\s*?")([^>"]*)(")/gi,replace:function(e,t,n,r){return n=n.replace(/(?:^|[\s])[\s]*MSO[_a-zA-Z0-9\-]*/gi,""),n=n.replace(/(?:^|[\s])[\s]*Apple-[_a-zA-Z0-9\-]*/gi,""),t+n+r}},{regex:/<a [^>]*?name\s*?=\s*?"OLE_LINK\d*?"[^>]*?>\s*?<\/a>/gi,replace:""}],e=this._cleanStyles(e),e=this._filterContentWithRules(e,t),e=this._cleanHTML(e),e=this._cleanSpans(e),e},_cleanStyles:function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelectorAll("[style]"),r=0;for(r=0;r<n.length;r++)n[r].removeAttribute("style");var i=t.querySelectorAll("[class]");for(r=0;r<i.length;r++)i[r].removeAttribute("class");return t.innerHTML},_cleanSpans:function(e){if(!e||e.length===0)return"";if(e.length===0||!e.match(/\S/))return e;var t=[{regex:/(<[^>]*?)(?:[\s]*(?:class|style|id)\s*?=\s*?"\s*?")+/gi,replace:"$1"}];e=this._filterContentWithRules(e,t);var n=document.createElement("div");n.innerHTML=e;var r=n.getElementsByTagName("span"),i=Array.prototype.slice.call(r,0);return i.forEach(function(e){if(!e.hasAttributes()){while(e.firstChild)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}}),n.innerHTML}},e.Base.mix(e.M.editor_atto.Editor,[y]),b.ATTRS={},b.prototype={applyFormat:function(t,n,r,i){function s(t,n,r,i,s,o){e.soon(e.bind(function(e,t,n,r,i,s){var o=window.rangy.getSelection(),u=o.getRangeAt(0);u.setStart(i,s),o.setSingleRange(u),t.apply(n,[e,r]),o.collapseToEnd(),this.saveSelection(),this.updateOriginal()},this,t,n,r,i,s,o))}r=r||this;var o=window.rangy.getSelection();if(o.isCollapsed){var u=this.editor.once("input",s,this,n,r,i,o.anchorNode,o.anchorOffset);this.editor.onceAfter(["click","selectstart"],u.detach,u);return}n.apply(r,[t,i]),this.saveSelection(),this.updateOriginal()},replaceTags:function(t,n){t.setAttribute("data-iterate",!0);var r=this.editor.one('[data-iterate="true"]');while(r){var i=e.Node.create("<"+n+" />").setAttrs(r.getAttrs()).removeAttribute("data-iterate");r.getAttribute("style")&&i.setAttribute("style",r.getAttribute("style")),r.getAttribute("class")&&i.setAttribute("class",r.getAttribute("class"));var s=r.getDOMNode().childNodes,o;o=s[0];while(typeof o!="undefined")i.append(o),o=s[0];r.replace(i),r=this.editor.one('[data-iterate="true"]')}},changeToCSS:function(e,t){var n=window.rangy.saveSelection();this.editor.all(".rangySelectionBoundary").setStyle("display",null),this.editor.all(e).addClass(t),this.replaceTags(this.editor.all("."+t),"span"),window.rangy.restoreSelection(n)},changeToTags:function(e,t){var n=window.rangy.saveSelection();this.editor.all(".rangySelectionBoundary").setStyle("display",null),this.replaceTags(this.editor.all('span[class="'+e+'"]'),t),this.editor.all(t+'[class="'+e+'"]').removeAttribute("class"),this.editor.all("."+e).each(function(n){n.wrap("<"+t+"/>"),n.removeClass(e)}),this.editor.all('[class="'+e+'"]').removeAttribute("class"),this.editor.all(t).removeClass(e),window.rangy.restoreSelection(n)}},e.Base.mix(e.M.editor_atto.Editor,[b]),w.ATTRS={},w.prototype={toolbar:null,openMenus:null,setupToolbar:function(){return this.toolbar=e.Node.create('<div class="'+r.TOOLBAR+'" role="toolbar" aria-live="off"/>'),this.openMenus=[],this._wrapper.appendChild(this.toolbar),this.textareaLabel&&this.toolbar.setAttribute("aria-labelledby",this.textareaLabel.get("id")),this.setupToolbarNavigation(),this}},e.Base.mix(e.M.editor_atto.Editor,[w]),E.ATTRS={},E.prototype={_tabFocus:null,setupToolbarNavigation:function(){return this._wrapper.delegate("key",this.toolbarKeyboardNavigation,"down:37,39","."+r.TOOLBAR,this),this._wrapper.delegate("focus",function(e){this._setTabFocus(e.currentTarget)},"."+r.TOOLBAR+" button",this),this},toolbarKeyboardNavigation:function(e){e.preventDefault();var t=this.toolbar.all("button"),n=1,r,i=e.target.ancestor("button",!0);e.keyCode===37&&(n=-1),r=this._findFirstFocusable(t,i,n),r&&(r.focus(),this._setTabFocus(r))},_findFirstFocusable:function(e,t,n){var r=0,i,s,o,u;u=e.indexOf(t),u<-1&&(u=0);while(r<e.size()){u+=n,u<0?u=e.size()-1:u>=e.size()&&(u=0),s=e.item(u),r++;if(s.hasAttribute("hidden")||s.hasAttribute("disabled"))continue;i=s.ancestor(".atto_group");if(i.hasAttribute("hidden"))continue;o=s;break}return o},checkTabFocus:function(){if(this._tabFocus)if(this._tabFocus.hasAttribute("disabled")||this._tabFocus.hasAttribute("hidden")||this._tabFocus.ancestor(".atto_group").hasAttribute("hidden")){var e=this._findFirstFocusable(this.toolbar.all("button"),this._tabFocus,-1);e&&(this._tabFocus.compareTo(document.activeElement)&&e.focus(),this._setTabFocus(e))}return this},_setTabFocus:function(e){return this._tabFocus&&this._tabFocus.setAttribute("tabindex","-1"),this._tabFocus=e,this._tabFocus.setAttribute("tabindex",0),this.toolbar.setAttribute("aria-activedescendant",this._tabFocus.generateID()),this}},e.Base.mix(e.M.editor_atto
.Editor,[E]),S.ATTRS={},S.prototype={_selections:null,_lastSelection:null,_focusFromClick:!1,_gesturestartededitor:!1,setupSelectionWatchers:function(){return this.on("atto:selectionchanged",this.saveSelection,this),this.editor.on("focus",this.restoreSelection,this),this.editor.on("mousedown",function(){this._focusFromClick=!0},this),this.editor.on("blur",function(){this._focusFromClick=!1,this.updateOriginal()},this),this.editor.on(["keyup","focus"],function(t){e.soon(e.bind(this._hasSelectionChanged,this,t))},this),e.one(document.body).on("gesturemovestart",function(e){this._wrapper.contains(e.target._node)?this._gesturestartededitor=!0:this._gesturestartededitor=!1},null,this),e.one(document.body).on("gesturemoveend",function(t){if(!this._gesturestartededitor)return;e.soon(e.bind(this._hasSelectionChanged,this,t))},{standAlone:!0},this),this},isActive:function(){var e=i.createRange(),t=i.getSelection();return t.rangeCount?!document.activeElement||!this.editor.compareTo(document.activeElement)&&!this.editor.contains(document.activeElement)?!1:(e.selectNode(this.editor.getDOMNode()),e.intersectsRange(t.getRangeAt(0))):!1},getSelectionFromNode:function(e){var t=i.createRange();return t.selectNode(e.getDOMNode()),[t]},saveSelection:function(){this.isActive()&&(this._selections=this.getSelection())},restoreSelection:function(){this._focusFromClick||this._selections&&this.setSelection(this._selections),this._focusFromClick=!1},getSelection:function(){return i.getSelection().getAllRanges()},selectionContainsNode:function(e){return i.getSelection().containsNode(e.getDOMNode(),!0)},selectionFilterMatches:function(e,t,n){typeof n=="undefined"&&(n=!0),t||(t=this.getSelectedNodes());var r=t.size()>0,i=!1,s=this.editor,o=function(e){return e===s};return s.one(e)?(t.each(function(t){if(n){if(!r||!t.ancestor(e,!0,o))r=!1}else!i&&t.ancestor(e,!0,o)&&(i=!0)},this),n?r:i):!1},getSelectedNodes:function(){var t=new e.NodeList,n,r,s,o,u;r=i.getSelection(),r.rangeCount?s=r.getRangeAt(0):s=i.createRange(),s.collapsed&&s.commonAncestorContainer!==this.editor.getDOMNode()&&s.commonAncestorContainer!==e.config.doc&&(s=s.cloneRange(),s.selectNode(s.commonAncestorContainer)),n=s.getNodes();for(u=0;u<n.length;u++)o=e.one(n[u]),this.editor.contains(o)&&t.push(o);return t},_hasSelectionChanged:function(e){var t=i.getSelection(),n,r=!1;return t.rangeCount?n=t.getRangeAt(0):n=i.createRange(),this._lastSelection&&!this._lastSelection.equals(n)?(r=!0,this._fireSelectionChanged(e)):(this._lastSelection=n,r)},_fireSelectionChanged:function(e){this.fire("atto:selectionchanged",{event:e,selectedNodes:this.getSelectedNodes()})},getSelectionParentNode:function(){var e=i.getSelection();return e.rangeCount?e.getRangeAt(0).commonAncestorContainer:!1},setSelection:function(e){var t=i.getSelection();t.setRanges(e)},insertContentAtFocusPoint:function(t){var n=i.getSelection(),r,s=e.Node.create(t);return n.rangeCount&&(r=n.getRangeAt(0)),r&&(r.deleteContents(),r.insertNode(s.getDOMNode())),s}},e.Base.mix(e.M.editor_atto.Editor,[S]),x.ATTRS={},x.prototype={disableCssStyling:function(){try{document.execCommand("styleWithCSS",0,!1)}catch(e){try{document.execCommand("useCSS",0,!0)}catch(t){try{document.execCommand("styleWithCSS",!1,!1)}catch(n){}}}},enableCssStyling:function(){try{document.execCommand("styleWithCSS",0,!0)}catch(e){try{document.execCommand("useCSS",0,!1)}catch(t){try{document.execCommand("styleWithCSS",!1,!0)}catch(n){}}}},toggleInlineSelectionClass:function(e){var t=e.join(" "),n=i.createClassApplier(t,{normalize:!0});n.toggleSelection()},formatSelectionInlineStyle:function(e){var t=this.PLACEHOLDER_CLASS,n=i.createClassApplier(t,{normalize:!0});n.applyToSelection(),this.editor.all("."+t).each(function(n){n.removeClass(t).setStyles(e)},this)},formatSelectionBlock:function(t,n){var r=this.getSelectionParentNode(),i,s,o,u,a,f;if(!r)return!1;i=this.editor,r=e.one(r),s=r.ancestor(function(e){var t=e.get("tagName");return t&&(t=t.toLowerCase()),e===i||t==="td"||t==="th"},!0),s&&(i=s),o=r.ancestor(this.BLOCK_TAGS.join(", "),!0),o&&(a=o.ancestor(function(e){return e===i},!1),a||(o=!1)),o||(u=e.Node.create("<p></p>"),i.get("childNodes").each(function(e){u.append(e.remove())}),i.append(u),o=u),t&&t!==""&&(f=e.Node.create("<"+t+"></"+t+">"),f.setAttrs(o.getAttrs()),o.get("childNodes").each(function(e){e.remove(),f.append(e)}),o.replace(f),o=f),n&&o.setAttrs(n);var l=this.getSelectionFromNode(o);return this.setSelection(l),o}},e.Base.mix(e.M.editor_atto.Editor,[x]),T.ATTRS={filepickeroptions:{value:{}}},T.prototype={canShowFilepicker:function(e){return typeof this.get("filepickeroptions")[e]!="undefined"},showFilepicker:function(t,n,r){var i=this;e.use("core_filepicker",function(e){var s=e.clone(i.get("filepickeroptions")[t],!0);s.formcallback=n,r&&(s.magicscope=r),M.core_filepicker.show(e,s)})}},e.Base.mix(e.M.editor_atto.Editor,[T])},"@VERSION@",{requires:["node","transition","io","overlay","escape","event","event-simulate","event-custom","node-event-html5","node-event-simulate","yui-throttle","moodle-core-notification-dialogue","moodle-core-notification-confirm","moodle-editor_atto-rangy","handlebars","timers","querystring-stringify"]});
YUI.add("moodle-editor_atto-menu",function(e,t){var n="moodle-editor_atto-menu",r='<div class="open {{config.buttonClass}} atto_menu" style="min-width:{{config.innerOverlayWidth}};"><ul class="dropdown-menu">{{#each config.items}}<li role="presentation" class="atto_menuentry"><a href="#" role="menuitem" data-index="{{@index}}" {{#each data}}data-{{@key}}="{{this}}"{{/each}}>{{{text}}}</a></li>{{/each}}</ul></div>',i=function(){i.superclass.constructor.apply(this,arguments)};e.extend(i,M.core.dialogue,{_menuHandlers:null,initializer:function(t){var n,i;this._menuHandlers=[];var s=e.Handlebars.compile(r),o=e.Node.create(s({config:t}));this.set("bodyContent",o),i=this.get("boundingBox"),i.addClass("editor_atto_controlmenu"),i.addClass("editor_atto_menu"),i.one(".moodle-dialogue-wrap").removeClass("moodle-dialogue-wrap").addClass("moodle-dialogue-content"),n=e.Node.create("<h3/>").addClass("accesshide").setHTML(this.get("headerText")),this.get("bodyContent").prepend(n),this.headerNode.hide(),this.footerNode.hide(),this._setupHandlers()},_setupHandlers:function(){var e=this.get("contentBox");this._menuHandlers.push(e.delegate("key",this._chooseMenuItem,"32, enter",".atto_menuentry",this),e.delegate("key",this._handleKeyboardEvent,"down:38,40",".dropdown-menu",this),e.on("focusoutside",this.hide,this),e.delegate("key",this.hide,"down:37,39,esc",".dropdown-menu",this))},_chooseMenuItem:function(e){e.target.simulate("click"),e.preventDefault()},hide:function(e){if(this.get("preventHideMenu")===!0)return;return e&&e.preventDefault(),i.superclass.hide.call(this,arguments)},_handleKeyboardEvent:function(e){e.preventDefault();var t=e.currentTarget.all('a[role="menuitem"]'),n=!1,r=0,i=1,s=0,o=e.target.ancestor('a[role="menuitem"]',!0),u;while(!n&&r<t.size())t.item(r)===o?n=!0:r++;if(!n)return;e.keyCode===38&&(i=-1);do r+=i,r<0?r=t.size()-1:r>=t.size()&&(r=0),u=t.item(r),s++;while(s<t.size()&&u!==o&&u.hasAttribute("hidden"));u&&u.focus(),e.preventDefault(),e.stopImmediatePropagation()}},{NAME:"menu",ATTRS:{headerText:{value:""}}}),e.Base.modifyAttrs(i,{width:{value:"auto"},hideOn:{value:[{eventName:"clickoutside"}]},extraClasses:{value:["editor_atto_menu"]},responsive:{value:!1},visible:{value:!1},center:{value:!1},closeButton:{value:!1}}),e.namespace("M.editor_atto").Menu=i},"@VERSION@",{requires:["moodle-core-notification-dialogue","node","event","event-custom"]});
YUI.add("moodle-editor_atto-plugin",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}function l(){}function c(){}var r=".atto_group.",i="_group";e.extend(n,e.Base,{name:null,editor:null,toolbar:null,initializer:function(e){this.name=e.name,this.toolbar=e.toolbar,this.editor=e.editor,this.buttons={},this.buttonNames=[],this.buttonStates={},this.menus={},this._primaryKeyboardShortcut=[],this._buttonHandlers=[],this._menuHideHandlers=[],this._highlightQueue={}},markUpdated:function(){return this.get("host").saveSelection(),this.get("host").updateOriginal()}},{NAME:"editorPlugin",ATTRS:{host:{writeOnce:!0},group:{writeOnce:!0,getter:function(t){var n=this.toolbar.one(r+t+i);return n||(n=e.Node.create('<div class="atto_group '+t+i+'"></div>'),this.toolbar.append(n)),n}}}}),e.namespace("M.editor_atto").EditorPlugin=n;var s='<button class="{{buttonClass}} atto_hasmenu" tabindex="-1" type="button" title="{{title}}"><span class="editor_atto_menu_icon"></span><span class="editor_atto_menu_expand"></span></button>',o="disabled",u="highlight",a="moodle-editor_atto-editor-plugin",f={EDITORWRAPPER:".editor_atto_content",MENUICON:".editor_atto_menu_icon",MENUEXPAND:".editor_atto_menu_expand"};l.ATTRS={},l.prototype={buttons:null,buttonNames:null,buttonStates:null,menus:null,DISABLED:0,ENABLED:1,_buttonHandlers:null,_menuHideHandlers:null,_primaryKeyboardShortcut:null,_highlightQueue:null,addButton:function(t){var n=this.get("group"),r=this.name,i="atto_"+r+"_button",s,o=this.get("host");t.exec&&(i=i+"_"+t.exec),t.buttonName?i=i+"_"+t.buttonName:t.buttonName=t.exec||r,t.buttonClass=i,t=this._normalizeIcon(t),t.title||(t.title="pluginname");var u=M.util.get_string(t.title,"atto_"+r);s=e.Node.create('<button type="button" class="'+i+'"'+'tabindex="-1"></button>'),s.setAttribute("title",u),window.require(["core/templates"],function(e){e.renderPix(t.icon,t.iconComponent,u).then(function(e){s.append(e)})}),n.append(s);var a=this.toolbar.getAttribute("aria-activedescendant");a||(s.setAttribute("tabindex","0"),this.toolbar.setAttribute("aria-activedescendant",s.generateID()),this.get("host")._tabFocus=s),t=this._normalizeCallback(t),this._buttonHandlers.push(this.toolbar.delegate("click",t.callback,"."+i,this)),t.keys&&(typeof t.keyDescription!="undefined"&&(this._primaryKeyboardShortcut[i]=t.keyDescription),this._addKeyboardListener(t.callback,t.keys,i),this._primaryKeyboardShortcut[i]&&s.setAttribute("title",M.util.get_string("plugin_title_shortcut","editor_atto",{title:u,shortcut:this._primaryKeyboardShortcut[i]})));if(t.tags){var f=!0;typeof t.tagMatchRequiresAll=="boolean"&&(f=t.tagMatchRequiresAll),this._buttonHandlers.push(o.on(["atto:selectionchanged","change"],function(n){typeof this._highlightQueue[t.buttonName]!="undefined"&&this._highlightQueue[t.buttonName].cancel(),this._highlightQueue[t.buttonName]=e.soon(e.bind(function(e){o.selectionFilterMatches(t.tags,e.selectedNodes,f)?this.highlightButtons(t.buttonName):this.unHighlightButtons(t.buttonName)},this,n))},this))}return this.buttonNames.push(t.buttonName),this.buttons[t.buttonName]=s,this.buttonStates[t.buttonName]=this.ENABLED,s},addBasicButton:function(e){return e.exec?(e.icon||(e.icon="e/"+e.exec),e.callback=function(){document.execCommand(e.exec,!1,null),this.markUpdated()},this.addButton(e)):null},addToolbarMenu:function(t){var n=this.get("group"),r=this.name,i="atto_"+r+"_button",o,u;t.buttonName?i=i+"_"+t.buttonName:t.buttonName=r,t.buttonClass=i,t=this._normalizeIcon(t),t.title||(t.title="pluginname");var a=M.util.get_string(t.title,"atto_"+r);t.menuColor||(t.menuColor="transparent");var l=e.Handlebars.compile(s);return o=e.Node.create(l({buttonClass:i,config:t,title:a})),window.require(["core/templates"],function(e){e.renderPix(t.icon,t.iconComponent,a).then(function(e){o.one(f.MENUICON).append(e)}),e.renderPix("t/expanded","core","").then(function(e){o.one(f.MENUEXPAND).append(e)})}),n.append(o),u=this.toolbar.getAttribute("aria-activedescendant"),u||(o.setAttribute("tabindex","0"),this.toolbar.setAttribute("aria-activedescendant",o.generateID())),this._buttonHandlers.push(this.toolbar.delegate("click",this._showToolbarMenu,"."+i,this,t),this.toolbar.delegate("key",this._showToolbarMenuAndFocus,"40, 32, enter","."+i,this,t)),this.buttonNames.push(t.buttonName),this.buttons[t.buttonName]=o,this.buttonStates[t.buttonName]=this.ENABLED,o},_showToolbarMenu:function(t,n){t.preventDefault();if(!this.isEnabled())return;if(t.currentTarget.ancestor("button",!0).hasAttribute(o))return;var r;this.menus[n.buttonClass]||(n.overlayWidth||(n.overlayWidth="14"),n.innerOverlayWidth||(n.innerOverlayWidth=parseInt(n.overlayWidth,10)-2+"em"),n.overlayWidth=parseInt(n.overlayWidth,10)+"em",this.menus[n.buttonClass]=new e.M.editor_atto.Menu(n),this.menus[n.buttonClass].get("contentBox").delegate("click",this._chooseMenuItem,".atto_menuentry a",this,n)),e.Array.each(this.get("host").openMenus,function(e){e.set("focusAfterHide",null)});var i=this.buttons[n.buttonName];i.focus(),this.get("host")._setTabFocus(i),r=this.menus[n.buttonClass],r.set("focusAfterHide",i),r.show(),r.align(this.buttons[n.buttonName],[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]),this.get("host").openMenus=[r]},_showToolbarMenuAndFocus:function(e,t){this._showToolbarMenu(e,t),this.menus[t.buttonClass].get("boundingBox").one("a").focus()},_chooseMenuItem:function(e,t,n){var r=e.target.ancestor("a",!0).getData("index"),i=this._normalizeCallback(t.items[r],t.globalItemConfig);n=this.menus[t.buttonClass],n.set("preventHideMenu",!0),i.callback(e,i._callback,i.callbackArgs),n.set("preventHideMenu",!1),n.set("focusAfterHide",this.get("host").editor),n.hide(e)},_normalizeCallback:function(t,n){return t._callbackNormalized?t:(n||(n={}),t.inlineFormat=t.inlineFormat||n.inlineFormat,t._inlineCallback=t.callback||n.callback,t._callback=t.callback||n.callback,t.inlineFormat&&typeof t._inlineCallback=="function"&&(t._callback=function(e,n){this.get("host").applyFormat(e
,t._inlineCallback,this,n)}),t.callback=e.rbind(this._callbackWrapper,this,t._callback,t.callbackArgs),t._callbackNormalized=!0,t)},_normalizeIcon:function(e){if(!e.iconurl){if(!e.iconComponent||e.iconComponent=="moodle")e.iconComponent="core";e.iconurl=M.util.image_url(e.icon,e.iconComponent)}return e},_callbackWrapper:function(e,t,n){e.preventDefault();if(!this.isEnabled())return;var r=e.currentTarget.ancestor("button",!0);if(r&&r.hasAttribute(o))return;!YUI.Env.UA.android&&!this.get("host").isActive()&&this.get("host").focus(),this.get("host").saveSelection(),r&&this.get("host")._setTabFocus(r);var i=[e,n];return this.get("host").restoreSelection(),t.apply(this,i)},_addKeyboardListener:function(t,n,r){var i="key",s=f.EDITORWRAPPER,o,u,a;if(e.Lang.isArray(n))return e.Array.each(n,function(e){this._addKeyboardListener(t,e)},this),this;typeof n=="object"?(n.eventtype&&(i=n.eventtype),n.container&&(s=n.container),o=n.keyCodes,u=t):(a=this._getDefaultMetaKey(),o=this._getKeyEvent()+n+"+"+a,typeof this._primaryKeyboardShortcut[r]=="undefined"&&(this._primaryKeyboardShortcut[r]=this._getDefaultMetaKeyDescription(n)),u=e.bind(function(e,n){this._eventUsesExactKeyModifiers(e,n)&&t.apply(this,[n])},this,[a])),this._buttonHandlers.push(this.editor.delegate(i,u,o,s,this))},_eventUsesExactKeyModifiers:function(t,n){var r=!0,i;return n.type!=="key"?!1:(i=e.Array.indexOf(t,"alt")>-1,r=r&&(n.altKey&&i||!n.altKey&&!i),i=e.Array.indexOf(t,"ctrl")>-1,r=r&&(n.ctrlKey&&i||!n.ctrlKey&&!i),i=e.Array.indexOf(t,"meta")>-1,r=r&&(n.metaKey&&i||!n.metaKey&&!i),i=e.Array.indexOf(t,"shift")>-1,r=r&&(n.shiftKey&&i||!n.shiftKey&&!i),r)},isEnabled:function(){var t=e.Object.some(this.buttonStates,function(e){return e===this.ENABLED},this);return t},disableButtons:function(e){return this._setButtonState(!1,e)},enableButtons:function(e){return this._setButtonState(!0,e)},_setButtonState:function(t,n){var r="setAttribute";return t&&(r="removeAttribute"),n?this.buttons[n]&&(this.buttons[n][r](o,o),this.buttonStates[n]=t?this.ENABLED:this.DISABLED):e.Array.each(this.buttonNames,function(e){this.buttons[e][r](o,o),this.buttonStates[e]=t?this.ENABLED:this.DISABLED},this),this.get("host").checkTabFocus(),this},highlightButtons:function(e){return this._changeButtonHighlight(!0,e)},unHighlightButtons:function(e){return this._changeButtonHighlight(!1,e)},_changeButtonHighlight:function(t,n){var r="addClass";return t||(r="removeClass"),n?this.buttons[n]&&this.buttons[n][r](u):e.Object.each(this.buttons,function(e){e[r](u)},this),this},_getDefaultMetaKey:function(){return e.UA.os==="macintosh"?"meta":"ctrl"},_getDefaultMetaKeyDescription:function(t){return e.UA.os==="macintosh"?M.util.get_string("editor_command_keycode","editor_atto",String.fromCharCode(t).toLowerCase()):M.util.get_string("editor_control_keycode","editor_atto",String.fromCharCode(t).toLowerCase())},_getKeyEvent:function(){return"down:"}},e.Base.mix(e.M.editor_atto.EditorPlugin,[l]),c.ATTRS={},c.prototype={_dialogue:null,getDialogue:function(t){t=t||{};var n=!1;t.focusAfterHide&&(n=t.focusAfterHide,delete t.focusAfterHide);if(!this._dialogue){var r=e.merge({visible:!1,modal:!0,close:!0,draggable:!0},t);this._dialogue=new M.core.dialogue(r)}return n!==!1&&(n===!0?this._dialogue.set("focusAfterHide",this.buttons[this.buttonNames[0]]):typeof n=="string"?this._dialogue.set("focusAfterHide",this.buttons[n]):this._dialogue.set("focusAfterHide",n)),this._dialogue}},e.Base.mix(e.M.editor_atto.EditorPlugin,[c])},"@VERSION@",{requires:["node","base","escape","event","event-outside","handlebars","event-custom","timers","moodle-editor_atto-menu"]});
YUI.add("moodle-atto_collapse-button",function(e,t){var n="atto_collapse",r="showgroups",i="collapse",s="collapsed",o=".atto_group";e.namespace("M.atto_collapse").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){var t=e.Object.size(this.get("host").get("plugins"));if(t<=1+parseInt(this.get(r),10))return;if(this.toolbar.all(o).size()>this.get(r))return;var i=this.addButton({icon:"icon",iconComponent:n,callback:this._toggle});this.get("host").on("pluginsloaded",function(e,t){this._setVisibility(t);var n=this.toolbar.all(o).item(this.get(r));n.insert('<div class="toolbarbreak"></div>',"before")},this,i)},_toggle:function(e){e.preventDefault();var t=this.buttons[i];t.getData(s)?(this.highlightButtons(i),this._setVisibility(t,!0)):(this.unHighlightButtons(i),this._setVisibility(t)),this.buttons[this.name].focus()},_setVisibility:function(e,t){var i=this.toolbar.all(o).slice(this.get(r));t?(e.set("title",M.util.get_string("showfewer",n)),i.show(),e.setData(s,!1)):(e.set("title",M.util.get_string("showmore",n)),i.hide(),e.setData(s,!0))}},{ATTRS:{showgroups:{value:3}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
